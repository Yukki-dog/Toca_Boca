<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–≤–∞—Ä—Ç–∏—Ä —Å –º–µ–±–µ–ª—å—é –∏ –æ–±–æ—è–º–∏</title>
<style>
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column;
    font-family: Arial, sans-serif; background: #fafafa;
    user-select: none;
  }
  #controls {
    background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 10px; display: flex; flex-wrap: wrap; gap: 12px; align-items: center;
    font-size: 14px;
  }
  label {
    display: flex; flex-direction: column; font-size: 13px; color: #555;
    min-width: 120px;
  }
  select, input[type="text"], input[type="color"], input[type="number"], button {
    margin-top: 4px;
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background: #f7f7f7;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
  }
  select:hover, input[type="text"]:hover, input[type="color"]:hover, input[type="number"]:hover, button:hover {
    background: #e2e2e2;
  }
  button {
    white-space: nowrap;
  }
  #roomContainer {
    position: relative;
    flex: 1;
    background: white;
    overflow: hidden;
    transition: background 0.7s ease;
  }
  #floorDiv {
    position: absolute;
    bottom: 0; left: 0; width: 100%; height: 150px;
    background: white;
    box-shadow: inset 0 5px 10px rgba(0,0,0,0.1);
    transition: background 0.7s ease;
    z-index: 1;
  }
  #furniturePanel {
    background: #fff;
    border-top: 1px solid #ddd;
    display: flex;
    align-items: center;
    overflow-x: auto;
    padding: 10px;
    gap: 12px;
    height: 120px;
  }
  .furniture-svg {
    width: 80px;
    height: 80px;
    cursor: pointer;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
    flex-shrink: 0;
    background: white;
  }
  .furniture-svg:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  }
  .furniture {
    position: absolute;
    cursor: grab;
    user-select: none;
    transition: transform 0.3s ease, opacity 0.4s ease;
    will-change: transform;
    z-index: 10;
  }
  .furniture:active {
    cursor: grabbing;
  }
</style>
</head>
<body>

<div id="controls">
  <button id="addRoomBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
  <button id="prevRoomBtn">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è –∫–æ–º–Ω–∞—Ç–∞</button>
  <button id="nextRoomBtn">–°–ª–µ–¥—É—é—â–∞—è –∫–æ–º–Ω–∞—Ç–∞ ‚Üí</button>

  <label>–û–±–æ–∏:
    <select id="wallpaperSelect">
      <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JS -->
    </select>
  </label>

  <label>–ü–æ–ª:
    <select id="floorSelect">
      <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JS -->
    </select>
  </label>

  <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ–±–æ–∏/–ø–æ–ª -->
  <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞ (–æ–±–æ–∏):
    <input type="color" id="customWallColor" value="#ffffff" />
  </label>
  <label>–¢–µ–∫—Å—Ç/—Å–º–∞–π–ª (–æ–±–æ–∏):
    <input type="text" id="customWallText" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: üå∏" />
  </label>
  <label>–®–∞–±–ª–æ–Ω (–æ–±–æ–∏):
    <select id="customWallPattern">
      <option value="1">–ó–∞–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è, –º–∞–ª–æ</option>
      <option value="2">–ó–∞–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è, –º–Ω–æ–≥–æ</option>
      <option value="3">–†–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è, –º–Ω–æ–≥–æ</option>
      <option value="4">–†–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è, –º–∞–ª–æ</option>
      <option value="5">–°–≤–æ–±–æ–¥–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</option>
    </select>
  </label>

  <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞ (–ø–æ–ª):
    <input type="color" id="customFloorColor" value="#ffffff" />
  </label>
  <label>–¢–µ–∫—Å—Ç/—Å–º–∞–π–ª (–ø–æ–ª):
    <input type="text" id="customFloorText" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: üåø" />
  </label>
  <label>–®–∞–±–ª–æ–Ω (–ø–æ–ª):
    <select id="customFloorPattern">
      <option value="1">–ó–∞–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è, –º–∞–ª–æ</option>
      <option value="2">–ó–∞–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è, –º–Ω–æ–≥–æ</option>
      <option value="3">–†–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è, –º–Ω–æ–≥–æ</option>
      <option value="4">–†–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è, –º–∞–ª–æ</option>
      <option value="5">–°–≤–æ–±–æ–¥–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</option>
    </select>
  </label>
</div>

<div id="roomContainer">
  <div id="floorDiv"></div>
</div>

<div id="furniturePanel"></div>

<script>
  const roomContainer = document.getElementById('roomContainer');
  const floorDiv = document.getElementById('floorDiv');

  const wallpaperSelect = document.getElementById('wallpaperSelect');
  const floorSelect = document.getElementById('floorSelect');

  const customWallColor = document.getElementById('customWallColor');
  const customWallText = document.getElementById('customWallText');
  const customWallPattern = document.getElementById('customWallPattern');

  const customFloorColor = document.getElementById('customFloorColor');
  const customFloorText = document.getElementById('customFloorText');
  const customFloorPattern = document.getElementById('customFloorPattern');

  const furniturePanel = document.getElementById('furniturePanel');
  const addRoomBtn = document.getElementById('addRoomBtn');
  const prevRoomBtn = document.getElementById('prevRoomBtn');
  const nextRoomBtn = document.getElementById('nextRoomBtn');

  // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±–æ–µ–≤ (CSS –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –∏ svg patterns –∫–∞–∫ background-image)
  const wallpaperPatterns = {
    white: 'white',
    stripes1: 'repeating-linear-gradient(45deg, #cde7d8 0 20px, #b5d6c1 20px 40px)',
    stripes2: 'repeating-linear-gradient(135deg, #f4e1e1 0 15px, #f8c9c9 15px 30px)',
    dots1: 'radial-gradient(circle 10px, #d3e0cc 95%, transparent 96%)',
    dots2: 'radial-gradient(circle 8px, #f7d1d1 95%, transparent 96%)',
    squares1: 'linear-gradient(90deg, #f0f0f0 25%, transparent 25%), linear-gradient(0deg, #f0f0f0 25%, transparent 25%)',
    triangles1: 'repeating-conic-gradient(#fde6e6 0deg 30deg, transparent 30deg 60deg)',
    chevron: 'repeating-linear-gradient(45deg, #d9ead3 0 15px, #a8d08d 15px 30px)',
    grid: 'linear-gradient(#ddd 1px, transparent 1px), linear-gradient(90deg, #ddd 1px, transparent 1px)',
    waves: 'repeating-radial-gradient(circle at 50% 100%, #d0f0c0 0 20px, transparent 21px 40px)'
  };

  // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–ª–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥–∏–µ —Ü–≤–µ—Ç–∞)
  const floorPatterns = {
    white: 'white',
    wood1: 'repeating-linear-gradient(to right, #d3c3a4 0 30px, #cbb793 30px 60px)',
    wood2: 'repeating-linear-gradient(to right, #8b7d6b 0 15px, #a79987 15px 30px)',
    tile1: 'repeating-linear-gradient(to right, #e6e6e6 0 25px, #c0c0c0 25px 50px)',
    tile2: 'repeating-linear-gradient(to right, #f0f0f0 0 40px, #d0d0d0 40px 80px)',
    stripes: 'repeating-linear-gradient(90deg, #faf3e0 0 15px, #f0e7d0 15px 30px)',
    dots: 'radial-gradient(circle 5px, #f0f0e0 95%, transparent 96%)',
    grid: 'linear-gradient(#ccc 1px, transparent 1px), linear-gradient(90deg, #ccc 1px, transparent 1px)',
    diagonal: 'repeating-linear-gradient(45deg, #e0d7c5 0 20px, #c9bea9 20px 40px)',
    marble: 'radial-gradient(circle at 40% 40%, #eee 0 25%, #ddd 26% 50%)'
  };

  // –ö–∞—Å—Ç–æ–º–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è –æ–±–æ–µ–≤ –∏ –ø–æ–ª–∞ (—Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç CSS background –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É)
  function generateCustomPattern(text, color, bgColor, patternType) {
    if (!text) return bgColor;

    text = text.trim() || "‚òÖ"; // –µ—Å–ª–∏ –ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç, —Å—Ç–∞–≤–∏–º –∑–≤–µ–∑–¥—É

    // –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
    const smallFont = '14px serif';
    const bigFont = '32px serif';

    switch(patternType) {
      case "1": // –ó–∞–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è, –º–∞–ª–æ
        return `radial-gradient(circle at center, ${bgColor} 0 60%, transparent 61%),
                repeating-radial-gradient(circle at center, ${color} 0 40px, transparent 41px 80px),
                repeating-conic-gradient(from 0deg at center, transparent 0deg 20deg, ${color} 20deg 40deg)`;
      case "2": // –ó–∞–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è, –º–Ω–æ–≥–æ
        return `repeating-conic-gradient(from 0deg at center, ${color} 0deg 15deg, transparent 15deg 30deg),
                repeating-radial-gradient(circle at center, ${color} 0 20px, transparent 21px 40px)`;
      case "3": // –†–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è, –º–Ω–æ–≥–æ
        return `linear-gradient(to right, ${color} 0 10px, transparent 10px 20px),
                repeating-linear-gradient(to right, transparent 0 20px, ${color} 20px 40px)`;
      case "4": // –†–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è, –º–∞–ª–æ
        return `linear-gradient(to right, ${color} 0 20px, transparent 20px 40px)`;
      case "5": // –°–≤–æ–±–æ–¥–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (–ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –±–µ–ª—ã–π —Ñ–æ–Ω ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–ª–æ–∂–Ω–µ–µ)
        return `${bgColor}`;
      default:
        return bgColor;
    }
  }

  // –ö–æ–º–Ω–∞—Ç—ã ‚Äî –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
  // –∫–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç: { wallpaperKey, floorKey, furniture: [{type, x, y, id}], customWall, customFloor }
  // customWall/customFloor: { color, text, patternType }
  let rooms = [
    { wallpaperKey: 'white', floorKey: 'white', furniture: [], customWall: null, customFloor: null },
    { wallpaperKey: 'white', floorKey: 'white', furniture: [], customWall: null, customFloor: null },
    { wallpaperKey: 'white', floorKey: 'white', furniture: [], customWall: null, customFloor: null }
  ];
  let currentRoom = 0;

  // –ú–µ–±–µ–ª—å ‚Äî –æ–±—ä–µ–∫—Ç—ã —Å SVG, –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å
  const furnitureItems = [
    {
      type: 'sofa',
      name: '–î–∏–≤–∞–Ω',
      svg: `<svg width="80" height="60" viewBox="0 0 80 60" xmlns="http://www.w3.org/2000/svg">
        <rect x="10" y="20" width="60" height="30" fill="#a0522d" stroke="#5a2a0c" stroke-width="3" rx="8" ry="8"/>
        <rect x="10" y="15" width="15" height="15" fill="#8b4513" rx="5" ry="5"/>
        <rect x="55" y="15" width="15" height="15" fill="#8b4513" rx="5" ry="5"/>
      </svg>`
    },
    {
      type: 'chair',
      name: '–ö—Ä–µ—Å–ª–æ',
      svg: `<svg width="50" height="60" viewBox="0 0 50 60" xmlns="http://www.w3.org/2000/svg">
        <rect x="10" y="20" width="30" height="30" fill="#d2691e" stroke="#8b4513" stroke-width="2" rx="5" ry="5"/>
        <rect x="10" y="10" width="15" height="15" fill="#a0522d" rx="3" ry="3"/>
        <rect x="25" y="10" width="15" height="15" fill="#a0522d" rx="3" ry="3"/>
      </svg>`
    },
    {
      type: 'table',
      name: '–°—Ç–æ–ª',
      svg: `<svg width="70" height="40" viewBox="0 0 70 40" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="15" width="60" height="20" fill="#deb887" stroke="#8b5a2b" stroke-width="2" rx="3" ry="3"/>
        <rect x="10" y="35" width="5" height="15" fill="#8b4513"/>
        <rect x="55" y="35" width="5" height="15" fill="#8b4513"/>
      </svg>`
    },
    {
      type: 'lamp',
      name: '–õ–∞–º–ø–∞',
      svg: `<svg width="30" height="60" viewBox="0 0 30 60" xmlns="http://www.w3.org/2000/svg">
        <circle cx="15" cy="15" r="12" fill="#f4e2a4" stroke="#d4bc5c" stroke-width="2"/>
        <rect x="12" y="25" width="6" height="30" fill="#8b7d4e" />
      </svg>`
    },
    {
      type: 'plant',
      name: '–†–∞—Å—Ç–µ–Ω–∏–µ',
      svg: `<svg width="40" height="60" viewBox="0 0 40 60" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="20" cy="30" rx="15" ry="25" fill="#4caf50" />
        <rect x="18" y="50" width="4" height="10" fill="#3e7d32" />
      </svg>`
    }
  ];

  // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π id –º–µ–±–µ–ª–∏ (–¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
  let furnitureIdCounter = 0;

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–º–Ω–∞—Ç—ã
  function renderRoom() {
    const room = rooms[currentRoom];

    // –û–±–æ–∏
    if (room.customWall) {
      roomContainer.style.background = generateCustomPattern(
        room.customWall.text,
        room.customWall.color,
        room.customWall.bgColor,
        room.customWall.patternType
      );
    } else {
      roomContainer.style.background = wallpaperPatterns[room.wallpaperKey] || 'white';
    }

    // –ü–æ–ª
    if (room.customFloor) {
      floorDiv.style.background = generateCustomPattern(
        room.customFloor.text,
        room.customFloor.color,
        room.customFloor.bgColor,
        room.customFloor.patternType
      );
    } else {
      floorDiv.style.background = floorPatterns[room.floorKey] || 'white';
    }

    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –º–µ–±–µ–ª—å DOM
    document.querySelectorAll('.furniture').forEach(el => el.remove());

    // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –º–µ–±–µ–ª—å –∫–æ–º–Ω–∞—Ç—ã
    room.furniture.forEach(item => {
      const div = document.createElement('div');
      div.classList.add('furniture');
      div.style.left = item.x + 'px';
      div.style.top = item.y + 'px';
      div.dataset.id = item.id;
      div.dataset.type = item.type;
      div.innerHTML = furnitureItems.find(f => f.type === item.type)?.svg || '';
      roomContainer.appendChild(div);

      // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –º–µ–±–µ–ª–∏
      makeDraggable(div);
    });

    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç—ã –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è
    wallpaperSelect.value = room.customWall ? 'custom' : room.wallpaperKey;
    floorSelect.value = room.customFloor ? 'custom' : room.floorKey;

    if (room.customWall) {
      customWallColor.value = room.customWall.color;
      customWallText.value = room.customWall.text;
      customWallPattern.value = room.customWall.patternType;
    }

    if (room.customFloor) {
      customFloorColor.value = room.customFloor.color;
      customFloorText.value = room.customFloor.text;
      customFloorPattern.value = room.customFloor.patternType;
    }
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç—ã
  addRoomBtn.onclick = () => {
    rooms.push({
      wallpaperKey: 'white',
      floorKey: 'white',
      furniture: [],
      customWall: null,
      customFloor: null
    });
    currentRoom = rooms.length - 1;
    renderRoom();
  };

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–æ–º–Ω–∞—Ç–∞–º
  prevRoomBtn.onclick = () => {
    if (currentRoom > 0) {
      currentRoom--;
      renderRoom();
    }
  };
  nextRoomBtn.onclick = () => {
    if (currentRoom < rooms.length - 1) {
      currentRoom++;
      renderRoom();
    }
  };

  // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ–≤ –æ–±–æ–µ–≤ –∏ –ø–æ–ª–∞
  function fillSelectOptions() {
    for (const key in wallpaperPatterns) {
      const opt = document.createElement('option');
      opt.value = key;
      opt.textContent = key === 'white' ? '–ë–µ–ª—ã–µ' : key.charAt(0).toUpperCase() + key.slice(1);
      wallpaperSelect.appendChild(opt);
    }
    const optCustom = document.createElement('option');
    optCustom.value = 'custom';
    optCustom.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ';
    wallpaperSelect.appendChild(optCustom);

    for (const key in floorPatterns) {
      const opt = document.createElement('option');
      opt.value = key;
      opt.textContent = key === 'white' ? '–ë–µ–ª—ã–π' : key.charAt(0).toUpperCase() + key.slice(1);
      floorSelect.appendChild(opt);
    }
    const optCustomF = document.createElement('option');
    optCustomF.value = 'custom';
    optCustomF.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ';
    floorSelect.appendChild(optCustomF);
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±–æ–µ–≤ –∫–æ–º–Ω–∞—Ç—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  wallpaperSelect.onchange = () => {
    const room = rooms[currentRoom];
    if (wallpaperSelect.value === 'custom') {
      room.customWall = {
        color: customWallColor.value,
        text: customWallText.value,
        patternType: customWallPattern.value,
        bgColor: customWallColor.value
      };
      room.wallpaperKey = null;
    } else {
      room.wallpaperKey = wallpaperSelect.value;
      room.customWall = null;
    }
    renderRoom();
  };
  floorSelect.onchange = () => {
    const room = rooms[currentRoom];
    if (floorSelect.value === 'custom') {
      room.customFloor = {
        color: customFloorColor.value,
        text: customFloorText.value,
        patternType: customFloorPattern.value,
        bgColor: customFloorColor.value
      };
      room.floorKey = null;
    } else {
      room.floorKey = floorSelect.value;
      room.customFloor = null;
    }
    renderRoom();
  };

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ–±–æ–µ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
  function updateCustomWall() {
    const room = rooms[currentRoom];
    if (room.customWall) {
      room.customWall.color = customWallColor.value;
      room.customWall.text = customWallText.value;
      room.customWall.patternType = customWallPattern.value;
      room.customWall.bgColor = customWallColor.value;
      renderRoom();
    }
  }
  customWallColor.oninput = updateCustomWall;
  customWallText.oninput = updateCustomWall;
  customWallPattern.onchange = updateCustomWall;

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–æ–ª–∞
  function updateCustomFloor() {
    const room = rooms[currentRoom];
    if (room.customFloor) {
      room.customFloor.color = customFloorColor.value;
      room.customFloor.text = customFloorText.value;
      room.customFloor.patternType = customFloorPattern.value;
      room.customFloor.bgColor = customFloorColor.value;
      renderRoom();
    }
  }
  customFloorColor.oninput = updateCustomFloor;
  customFloorText.oninput = updateCustomFloor;
  customFloorPattern.onchange = updateCustomFloor;

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–±–µ–ª–∏ –≤ –ø–∞–Ω–µ–ª—å
  function renderFurniturePanel() {
    furnitureItems.forEach(item => {
      const div = document.createElement('div');
      div.classList.add('furniture-svg');
      div.title = item.name;
      div.innerHTML = item.svg;
      div.onclick = () => {
        addFurnitureToRoom(item.type);
      };
      furniturePanel.appendChild(div);
    });
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–±–µ–ª–∏ –≤ —Ç–µ–∫—É—â—É—é –∫–æ–º–Ω–∞—Ç—É
  function addFurnitureToRoom(type) {
    const room = rooms[currentRoom];
    furnitureIdCounter++;
    const furnitureObj = {
      id: furnitureIdCounter,
      type,
      x: 50, // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è (–º–æ–∂–Ω–æ —Ä–∞–Ω–¥–æ–º)
      y: 50
    };
    room.furniture.push(furnitureObj);
    renderRoom();
  }

  // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –º–µ–±–µ–ª–∏
  function makeDraggable(el) {
    let offsetX = 0, offsetY = 0, dragging = false;

    el.onpointerdown = e => {
      dragging = true;
      offsetX = e.clientX - el.getBoundingClientRect().left;
      offsetY = e.clientY - el.getBoundingClientRect().top;
      el.setPointerCapture(e.pointerId);
      el.style.transition = 'none';
    };

    el.onpointermove = e => {
      if (!dragging) return;
      e.preventDefault();

      const containerRect = roomContainer.getBoundingClientRect();
      let newX = e.clientX - containerRect.left - offsetX;
      let newY = e.clientY - containerRect.top - offsetY;

      // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≥—Ä–∞–Ω–∏—Ü–∞–º –∫–æ–º–Ω–∞—Ç—ã
      const elRect = el.getBoundingClientRect();
      const maxX = containerRect.width - elRect.width;
      const maxY = containerRect.height - elRect.height;

      if (newX < 0) newX = 0;
      if (newY < 0) newY = 0;
      if (newX > maxX) newX = maxX;
      if (newY > maxY) newY = maxY;

      el.style.left = newX + 'px';
      el.style.top = newY + 'px';
    };

    el.onpointerup = e => {
      if (!dragging) return;
      dragging = false;
      el.releasePointerCapture(e.pointerId);

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∫–æ–º–Ω–∞—Ç–µ
      const room = rooms[currentRoom];
      const id = +el.dataset.id;
      const furnitureObj = room.furniture.find(f => f.id === id);
      if (furnitureObj) {
        furnitureObj.x = parseInt(el.style.left);
        furnitureObj.y = parseInt(el.style.top);
      }

      el.style.transition = '';
    };
  }

  // –ö–ª–∞–≤–∏—à–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç
  window.onkeydown = e => {
    if (e.key === 'ArrowRight') {
      nextRoomBtn.click();
    } else if (e.key === 'ArrowLeft') {
      prevRoomBtn.click();
    }
  };

  fillSelectOptions();
  renderFurniturePanel();
  renderRoom();
</script>

</body>
</html>
