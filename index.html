<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Квартира — редактор</title>
<style>
  body, html {
    margin:0; padding:0; height:100vh; display:flex; flex-direction: column;
    font-family: Arial, sans-serif; background: #fafafa;
  }
  #roomContainer {
    flex: 1; position: relative; overflow: hidden;
    transition: background 0.7s ease;
    background: white;
  }
  #floorDiv {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 150px;
    background: white;
    box-shadow: inset 0 5px 10px rgba(0,0,0,0.1);
    transition: background 0.7s ease;
    z-index: 1;
  }
  #controls {
    display: flex; gap: 10px; padding: 10px; background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    align-items: center;
  }
  button, select {
    padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc;
    cursor: pointer; background: #f5f5f5;
  }
  button:hover, select:hover {
    background: #e0e0e0;
  }
  #furniturePanel {
    height: 120px; background: #fff; border-top: 1px solid #ddd;
    overflow-x: auto; display: flex; align-items: center; padding: 10px;
  }
  #furniturePanel img {
    width: 80px; height: 80px; margin-right: 10px; cursor: pointer;
    border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s;
  }
  #furniturePanel img:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  .furniture {
    position: absolute; cursor: grab; user-select: none;
    transition: transform 0.3s ease, opacity 0.4s ease;
    will-change: transform;
    z-index: 10;
  }
  .furniture:active {
    cursor: grabbing;
  }
</style>
</head>
<body>

<div id="controls">
  <button id="addRoomBtn">➕ Добавить комнату</button>
  <button id="prevRoomBtn">← Предыдущая комната</button>
  <button id="nextRoomBtn">Следующая комната →</button>

  <label>Обои:
    <select id="wallpaperSelect">
      <option value="white">Белые</option>
      <option value="pattern1">Зеленый узор</option>
      <option value="pattern2">Розовый узор</option>
      <option value="pattern3">Геометрия</option>
    </select>
  </label>

  <label>Пол:
    <select id="floorSelect">
      <option value="white">Белый</option>
      <option value="floor1">Дерево светлое</option>
      <option value="floor2">Дерево темное</option>
      <option value="floor3">Плитка серая</option>
    </select>
  </label>
</div>

<div id="roomContainer">
  <div id="floorDiv"></div>
</div>

<div id="furniturePanel"></div>

<script>
  const roomContainer = document.getElementById('roomContainer');
  const floorDiv = document.getElementById('floorDiv');
  const wallpaperSelect = document.getElementById('wallpaperSelect');
  const floorSelect = document.getElementById('floorSelect');
  const furniturePanel = document.getElementById('furniturePanel');
  const addRoomBtn = document.getElementById('addRoomBtn');
  const prevRoomBtn = document.getElementById('prevRoomBtn');
  const nextRoomBtn = document.getElementById('nextRoomBtn');

  const wallpaperStyles = {
    white: 'white',
    pattern1: 'repeating-linear-gradient(45deg, #cde7d8, #cde7d8 20px, #b5d6c1 20px, #b5d6c1 40px)',
    pattern2: 'repeating-radial-gradient(circle at center, #ffe4e1 0, #f4a8a8 30px)',
    pattern3: 'repeating-linear-gradient(135deg, #f9e7e7, #f9e7e7 15px, #fadede 15px, #fadede 30px)'
  };

  const floorStyles = {
    white: 'white',
    floor1: 'repeating-linear-gradient(to right, #d3c3a4, #d3c3a4 30px, #cbb793 30px, #cbb793 60px)',
    floor2: 'repeating-linear-gradient(to right, #8b7d6b, #8b7d6b 15px, #a79987 15px, #a79987 30px)',
    floor3: 'repeating-linear-gradient(to right, #e6e6e6, #e6e6e6 25px, #c0c0c0 25px, #c0c0c0 50px)'
  };

  const furnitureItems = [
    { type: 'sofa', src: 'https://i.postimg.cc/2jX9v8DB/sofa.png', name: 'Диван' },
    { type: 'chair', src: 'https://i.postimg.cc/3x87wQ6D/chair.png', name: 'Кресло' },
    { type: 'table', src: 'https://i.postimg.cc/y6Xm8MWr/table.png', name: 'Стол' },
    { type: 'lamp', src: 'https://i.postimg.cc/9f3fF5mh/lamp.png', name: 'Лампа' },
    { type: 'plant', src: 'https://i.postimg.cc/jdX0RxwG/plant.png', name: 'Растение' }
  ];

  let rooms = [
    { wallpaper: 'white', floor: 'white', furnitures: [] },
    { wallpaper: 'white', floor: 'white', furnitures: [] },
    { wallpaper: 'white', floor: 'white', furnitures: [] }
  ];
  let currentRoom = 0;

  function renderRoom() {
    const room = rooms[currentRoom];
    roomContainer.style.background = wallpaperStyles[room.wallpaper];
    floorDiv.style.background = floorStyles[room.floor];

    wallpaperSelect.value = room.wallpaper;
    floorSelect.value = room.floor;

    // Очистить мебель
    roomContainer.querySelectorAll('.furniture').forEach(el => el.remove());

    // Добавить мебель
    room.furnitures.forEach(furn => {
      const el = createFurnitureElement(furn.type, furn.x, furn.y);
      roomContainer.appendChild(el);
      furn.el = el;
    });
  }

  function createFurnitureElement(type, x=100, y=200) {
    const item = furnitureItems.find(f => f.type === type);
    if (!item) return null;

    const el = document.createElement('img');
    el.src = item.src;
    el.alt = item.name;
    el.classList.add('furniture');
    el.style.left = x + 'px';
    el.style.top = y + 'px';

    // Drag and drop
    let offsetX, offsetY;
    el.addEventListener('mousedown', e => {
      offsetX = e.clientX - el.getBoundingClientRect().left;
      offsetY = e.clientY - el.getBoundingClientRect().top;
      el.style.cursor = 'grabbing';

      function onMove(e) {
        el.style.left = (e.clientX - offsetX) + 'px';
        el.style.top = (e.clientY - offsetY) + 'px';
      }
      function onUp() {
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onUp);
        el.style.cursor = 'grab';

        // Обновить позицию мебели в комнате
        const furn = rooms[currentRoom].furnitures.find(f => f.el === el);
        if (furn) {
          furn.x = parseInt(el.style.left);
          furn.y = parseInt(el.style.top);
        }
      }
      document.addEventListener('mousemove', onMove);
      document.addEventListener('mouseup', onUp);
    });

    return el;
  }

  furnitureItems.forEach(item => {
    const img = document.createElement('img');
    img.src = item.src;
    img.alt = item.name;
    img.setAttribute('data-type', item.type);
    furniturePanel.appendChild(img);
  });

  furniturePanel.addEventListener('click', e => {
    if (e.target.tagName === 'IMG') {
      const type = e.target.getAttribute('data-type');
      const el = createFurnitureElement(type);
      if (el) {
        rooms[currentRoom].furnitures.push({ type, x: 100, y: 200, el });
        roomContainer.appendChild(el);
      }
    }
  });

  wallpaperSelect.addEventListener('change', () => {
    rooms[currentRoom].wallpaper = wallpaperSelect.value;
    // плавно меняем фон
    roomContainer.style.transition = 'background 0.7s ease';
    renderRoom();
  });

  floorSelect.addEventListener('change', () => {
    rooms[currentRoom].floor = floorSelect.value;
    floorDiv.style.transition = 'background 0.7s ease';
    renderRoom();
  });

  addRoomBtn.addEventListener('click', () => {
    rooms.push({ wallpaper: 'white', floor: 'white', furnitures: [] });
    currentRoom = rooms.length - 1;
    renderRoom();
  });

  prevRoomBtn.addEventListener('click', () => {
    if (currentRoom > 0) {
      currentRoom--;
      renderRoom();
    }
  });
  nextRoomBtn.addEventListener('click', () => {
    if (currentRoom < rooms.length - 1) {
      currentRoom++;
      renderRoom();
    }
  });

  renderRoom();
</script>

</body>
</html>
