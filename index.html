<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ú–æ–π —É—é—Ç–Ω—ã–π –¥–æ–º</title>
<style>
  body {
    margin: 0; font-family: Arial, sans-serif;
    background: #f0f0f0;
    overflow: hidden;
  }
  #app {
    position: relative;
    width: 100vw; height: 100vh;
    overflow: hidden;
  }
  /* –ö–æ–º–Ω–∞—Ç—ã */
  #room-container {
    position: absolute; top: 40px; left: 150px; right: 0; bottom: 0;
    background: #fff;
    border: 2px solid #ccc;
    border-radius: 8px;
    overflow: hidden;
  }
  .room {
    width: 100%; height: 100%;
    position: absolute;
    top:0; left:0;
    transition: opacity 0.5s ease;
    opacity: 0;
    pointer-events: none;
  }
  .room.active {
    opacity: 1;
    pointer-events: all;
  }

  /* –ü–∞–Ω–µ–ª—å –º–µ–±–µ–ª–∏ */
  #furniture-panel {
    position: absolute;
    top: 40px; left: 0; bottom: 0;
    width: 150px;
    background: rgba(255 255 255 / 0.95);
    border-right: 2px solid #ccc;
    overflow-y: auto;
    padding: 10px;
    display: none;
  }
  #furniture-panel.active {
    display: block;
  }
  #furniture-panel h2 {
    margin: 0 0 10px;
    font-size: 18px;
    text-align: center;
  }
  .furniture-item {
    cursor: grab;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 5px;
    text-align: center;
    user-select: none;
  }
  .furniture-item img {
    max-width: 100%;
    display: block;
    margin: 0 auto;
    background: transparent;
  }

  /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
  #top-bar {
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 40px;
    background: #333;
    color: #eee;
    display: flex;
    align-items: center;
    padding: 0 10px;
    gap: 10px;
  }
  #top-bar button {
    background: #555;
    border: none;
    color: #eee;
    padding: 6px 12px;
    cursor: pointer;
    border-radius: 4px;
    font-weight: bold;
    user-select: none;
  }
  #top-bar button:hover {
    background: #777;
  }

  /* –ü—Ä–æ—Ñ–∏–ª—å (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) */
  #profile-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0 0 0 / 0.75);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  #profile-overlay.active {
    display: flex;
  }
  #profile-window {
    background: #fff;
    border-radius: 10px;
    width: 400px;
    max-width: 90vw;
    max-height: 90vh;
    padding: 20px;
    overflow-y: auto;
  }
  #profile-window h2 {
    margin-top: 0;
  }
  #profile-window label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }
  #profile-window input[type=text] {
    width: 100%;
    padding: 6px 8px;
    font-size: 16px;
    margin-top: 5px;
  }
  #avatar-preview {
    font-size: 48px;
    text-align: center;
    margin: 10px 0;
    width: 80px; height: 80px;
    line-height: 80px;
    border-radius: 50%;
    margin-left: auto;
    margin-right: auto;
    user-select: none;
  }
  #profile-window button {
    margin-top: 15px;
    padding: 10px;
    width: 100%;
    background: #333;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 6px;
    font-size: 16px;
  }
  #friends-list {
    margin-top: 15px;
  }
  .friend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
    border-bottom: 1px solid #ccc;
    padding-bottom: 6px;
  }
  .friend-avatar {
    font-size: 32px;
    width: 40px; height: 40px;
    line-height: 40px;
    border-radius: 50%;
    background: #eee;
    text-align: center;
    user-select: none;
  }
  .friend-name {
    flex-grow: 1;
    font-weight: bold;
  }
  .friend-btn {
    background: #555;
    border: none;
    color: #eee;
    padding: 4px 8px;
    cursor: pointer;
    border-radius: 4px;
    font-size: 14px;
  }
  .friend-btn:hover {
    background: #777;
  }
</style>
</head>
<body>
<div id="app">
  <div id="top-bar">
    <button id="profile-btn">–ü</button>
    <button id="furniture-btn">–ú</button>
    <button id="prev-room-btn">‚Üê</button>
    <button id="next-room-btn">‚Üí</button>
    <button id="add-room-btn">‚ûï</button>
    <button id="wallpaper-btn">–û–±–æ–∏/–ü–æ–ª</button>
    <button id="share-link-btn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
    <span id="room-name" style="margin-left:auto; font-weight:bold; color:#eee;">–ö–æ–º–Ω–∞—Ç–∞ 1</span>
  </div>

  <div id="furniture-panel">
    <h2>–ú–µ–±–µ–ª—å</h2>
    <!-- –º–µ–±–µ–ª—å –±—É–¥–µ—Ç —Ç—É—Ç -->
  </div>

  <div id="room-container">
    <!-- –∫–æ–º–Ω–∞—Ç—ã –∑–¥–µ—Å—å -->
  </div>

  <div id="profile-overlay">
    <div id="profile-window">
      <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
      <label for="nickname-input">–ù–∏–∫ (–º–∞–∫—Å 25 —Å–∏–º–≤–æ–ª–æ–≤)</label>
      <input id="nickname-input" type="text" maxlength="25" />
      <label for="avatar-input">–ê–≤–∞—Ç–∞—Ä–∫–∞ (1-2 —Å–∏–º–≤–æ–ª–∞)</label>
      <input id="avatar-input" type="text" maxlength="2" />
      <label for="avatar-bg-input">–¶–≤–µ—Ç —Ñ–æ–Ω–∞ (HEX, –Ω–∞–ø—Ä–∏–º–µ—Ä #ffcc00)</label>
      <input id="avatar-bg-input" type="text" maxlength="7" placeholder="#336699" />
      <div id="avatar-preview"></div>
      <button id="save-profile-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>

      <h3>–î—Ä—É–∑—å—è</h3>
      <label for="add-friend-id">–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞ –ø–æ ID</label>
      <input id="add-friend-id" type="text" maxlength="10" />
      <button id="add-friend-btn">–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</button>

      <div id="friends-list"></div>
    </div>
  </div>
</div>

<script>
// --- –î–∞–Ω–Ω—ã–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ---
const defaultFurnitureList = [
  {id:"chair", name:"–°—Ç—É–ª", src:"https://i.imgur.com/UXk9W9D.png", width:80, height:80},
  {id:"table", name:"–°—Ç–æ–ª", src:"https://i.imgur.com/99Njmi2.png", width:100, height:60},
  {id:"lamp", name:"–õ–∞–º–ø–∞", src:"https://i.imgur.com/YJvRjQO.png", width:60, height:100},
  {id:"sofa", name:"–î–∏–≤–∞–Ω", src:"https://i.imgur.com/7Rl9yAo.png", width:140, height:70},
  {id:"rug", name:"–ö–æ–≤–µ—Ä", src:"https://i.imgur.com/GJSzwQG.png", width:100, height:60}
];

// --- –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö ---
let profile = {
  id: generateId(),
  nickname: "–ò–≥—Ä–æ–∫",
  avatar: "üê∂",
  avatarBg: "#66ccff",
  friends: []
};

let rooms = [
  createRoom()
];
let currentRoomIndex = 0;

// --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–±–µ–ª–∏ (–≤ –∫–æ–º–Ω–∞—Ç–∞—Ö) ---
// –ú–µ–±–µ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–Ω–∞—Ç—ã, –∫–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç –∏–º–µ–µ—Ç:
// idFurniture, x, y, scale, rotation
function createRoom() {
  return {
    name: "–ö–æ–º–Ω–∞—Ç–∞ " + (rooms.length + 1),
    wallpaper: { pattern:"‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†", color:"#f5f5dc" },
    floor: { pattern:"||||||", color:"#deb887" },
    furniture: []
  };
}

function generateId() {
  return Math.random().toString(36).slice(2, 8);
}

// --- –≠–ª–µ–º–µ–Ω—Ç—ã DOM ---
const roomContainer = document.getElementById("room-container");
const furniturePanel = document.getElementById("furniture-panel");
const profileOverlay = document.getElementById("profile-overlay");
const nicknameInput = document.getElementById("nickname-input");
const avatarInput = document.getElementById("avatar-input");
const avatarBgInput = document.getElementById("avatar-bg-input");
const avatarPreview = document.getElementById("avatar-preview");
const saveProfileBtn = document.getElementById("save-profile-btn");
const friendsList = document.getElementById("friends-list");
const addFriendIdInput = document.getElementById("add-friend-id");
const addFriendBtn = document.getElementById("add-friend-btn");

const profileBtn = document.getElementById("profile-btn");
const furnitureBtn = document.getElementById("furniture-btn");
const prevRoomBtn = document.getElementById("prev-room-btn");
const nextRoomBtn = document.getElementById("next-room-btn");
const addRoomBtn = document.getElementById("add-room-btn");
const wallpaperBtn = document.getElementById("wallpaper-btn");
const shareLinkBtn = document.getElementById("share-link-btn");
const roomNameSpan = document.getElementById("room-name");

// --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
function init() {
  loadData();
  updateRoomView();
  renderFurniturePanel();
  updateProfileUI();
  bindEvents();
}
window.onload = init;

// --- –°–æ–±—ã—Ç–∏—è ---
function bindEvents() {
  profileBtn.onclick = () => toggleProfile(true);
  furnitureBtn.onclick = () => toggleFurniturePanel();
  prevRoomBtn.onclick = () => changeRoom(-1);
  nextRoomBtn.onclick = () => changeRoom(1);
  addRoomBtn.onclick = () => addRoom();
  wallpaperBtn.onclick = () => changeWallpaperFloor();
  saveProfileBtn.onclick = () => saveProfile();
  addFriendBtn.onclick = () => addFriend();
  shareLinkBtn.onclick = () => copyShareLink();

  avatarInput.oninput = updateAvatarPreview;
  avatarBgInput.oninput = updateAvatarPreview;

  nicknameInput.oninput = () => {
    if(nicknameInput.value.length > 25) nicknameInput.value = nicknameInput.value.slice(0,25);
  };
}

// --- –ü—Ä–æ—Ñ–∏–ª—å ---
function toggleProfile(show) {
  profileOverlay.classList.toggle("active", show);
  if(show) {
    nicknameInput.value = profile.nickname;
    avatarInput.value = profile.avatar;
    avatarBgInput.value = profile.avatarBg;
    updateAvatarPreview();
    renderFriends();
  }
}
function saveProfile() {
  const nick = nicknameInput.value.trim();
  if(nick.length === 0) {
    alert("–ù–∏–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º");
    return;
  }
  profile.nickname = nick;
  let avatarVal = avatarInput.value.trim();
  profile.avatar = avatarVal.length > 0 ? avatarVal : "üôÇ";
  let bg = avatarBgInput.value.trim();
  profile.avatarBg = /^#([0-9A-Fa-f]{6})$/.test(bg) ? bg : "#66ccff";
  updateProfileUI();
  saveData();
  alert("–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
  toggleProfile(false);
}

function updateAvatarPreview() {
  avatarPreview.textContent = avatarInput.value || "üôÇ";
  avatarPreview.style.backgroundColor = avatarBgInput.value || "#66ccff";
}

function updateProfileUI() {
  // —Ç—É—Ç –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∞–≤–∞—Ç–∞—Ä –∏ –Ω–∏–∫ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
}

// --- –î—Ä—É–∑—å—è ---
function renderFriends() {
  friendsList.innerHTML = "";
  profile.friends.forEach(friend => {
    const div = document.createElement("div");
    div.className = "friend-item";
    div.innerHTML = `
      <div class="friend-avatar" style="background:${friend.avatarBg}">${friend.avatar}</div>
      <div class="friend-name">${friend.nickname}</div>
      <button class="friend-btn" onclick="enterFriendRoom('${friend.id}')">–í–æ–π—Ç–∏</button>
      <button class="friend-btn" onclick="copyToClipboard('${friend.id}')">ID</button>
      <button class="friend-btn" onclick="removeFriend('${friend.id}')">–£–¥–∞–ª–∏—Ç—å</button>
    `;
    friendsList.appendChild(div);
  });
}

function addFriend() {
  const id = addFriendIdInput.value.trim();
  if(id.length === 0) return alert("–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞");
  if(profile.friends.find(f => f.id === id)) return alert("–î—Ä—É–≥ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω");
  // –ó–¥–µ—Å—å –º–æ–≥–ª–æ –±—ã –±—ã—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º,
  // –Ω–æ —É –Ω–∞—Å –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏–º –¥—Ä—É–≥–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
  profile.friends.push({id, nickname:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ", avatar:"‚ùì", avatarBg:"#ccc"});
  saveData();
  renderFriends();
  addFriendIdInput.value = "";
  alert("–î—Ä—É–≥ –¥–æ–±–∞–≤–ª–µ–Ω");
}

function enterFriendRoom(friendId) {
  alert("–ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥—Ä—É–≥–∞ –ø–æ ID –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —ç—Ç–æ–º –ø—Ä–æ—Ç–æ—Ç–∏–ø–µ.");
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text);
  alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: " + text);
}

function removeFriend(friendId) {
  profile.friends = profile.friends.filter(f => f.id !== friendId);
  saveData();
  renderFriends();
}

// --- –ö–æ–º–Ω–∞—Ç—ã ---
function updateRoomView() {
  roomContainer.innerHTML = "";
  rooms.forEach((room, i) => {
    const div = document.createElement("div");
    div.className = "room" + (i === currentRoomIndex ? " active" : "");
    div.style.background = room.wallpaper.color;
    div.textContent = room.name;
    roomContainer.appendChild(div);
  });
  roomNameSpan.textContent = rooms[currentRoomIndex].name;
}

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
function changeRoom(dir) {
  currentRoomIndex += dir;
  if(currentRoomIndex < 0) currentRoomIndex = rooms.length -1;
  if(currentRoomIndex >= rooms.length) currentRoomIndex = 0;
  updateRoomView();
}
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
function addRoom() {
  rooms.push(createRoom());
  currentRoomIndex = rooms.length -1;
  updateRoomView();
}

// --- –û–±–æ–∏ –∏ –ø–æ–ª ---
// –ü—Ä–∏–º–µ—Ä –∑–∞–º–µ–Ω—ã —Ü–≤–µ—Ç–∞ –æ–±–æ–µ–≤ –∏ –ø–æ–ª–∞
function changeWallpaperFloor() {
  let room = rooms[currentRoomIndex];
  // –ü—Ä–æ—Å—Ç–æ–π —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
  const colors = ["#f5f5dc","#ffe4e1","#e6ffe6","#d6e6ff","#fffacd"];
  const floors = ["#deb887","#c2b280","#a9a9a9","#dcdcdc","#f0e68c"];
  let ci = colors.indexOf(room.wallpaper.color);
  let fi = floors.indexOf(room.floor.color);
  room.wallpaper.color = colors[(ci+1)%colors.length];
  room.floor.color = floors[(fi+1)%floors.length];
  updateRoomView();
  saveData();
}

// --- –ú–µ–±–µ–ª—å ---
// –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º–µ–±–µ–ª–∏ –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ —Å –∏–º–µ–Ω–∞–º–∏
function renderFurniturePanel() {
  furniturePanel.innerHTML = "<h2>–ú–µ–±–µ–ª—å</h2>";
  defaultFurnitureList.forEach(furn => {
    const div = document.createElement("div");
    div.className = "furniture-item";
    div.draggable = true;
    div.dataset.id = furn.id;
    div.innerHTML = `<img src="${furn.src}" alt="${furn.name}" />${furn.name}`;
    furniturePanel.appendChild(div);

    div.ondragstart = e => {
      e.dataTransfer.setData("text/plain", furn.id);
    };
  });
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–±–µ–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç—É –ø—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏
roomContainer.ondragover = e => {
  e.preventDefault();
};
roomContainer.ondrop = e => {
  e.preventDefault();
  const id = e.dataTransfer.getData("text/plain");
  const furn = defaultFurnitureList.find(f => f.id === id);
  if(!furn) return;
  // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–±–µ–ª—å –≤ –∫–æ–º–Ω–∞—Ç—É
  const room = rooms[currentRoomIndex];
  room.furniture.push({
    idFurniture: furn.id,
    x: e.offsetX,
    y: e.offsetY,
    scale: 1,
    rotation: 0
  });
  updateRoomView();
  saveData();
  renderRoomFurniture();
};

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–µ–±–µ–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ
function renderRoomFurniture() {
  const roomDiv = roomContainer.querySelector(".room.active");
  if(!roomDiv) return;

  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –º–µ–±–µ–ª—å
  [...roomDiv.querySelectorAll(".room-furniture")].forEach(el => el.remove());

  const room = rooms[currentRoomIndex];
  room.furniture.forEach((furn, i) => {
    const dfurn = defaultFurnitureList.find(d => d.id === furn.idFurniture);
    if(!dfurn) return;

    const el = document.createElement("img");
    el.src = dfurn.src;
    el.className = "room-furniture";
    el.style.position = "absolute";
    el.style.left = furn.x + "px";
    el.style.top = furn.y + "px";
    el.style.width = dfurn.width * furn.scale + "px";
    el.style.height = dfurn.height * furn.scale + "px";
    el.style.transform = `rotate(${furn.rotation}rad)`;
    el.style.transformOrigin = "center center";
    el.style.cursor = "grab";
    el.draggable = false;
    roomDiv.appendChild(el);

    // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –º–µ–±–µ–ª–∏
    let drag = false;
    let startX, startY;
    el.onmousedown = e => {
      e.preventDefault();
      drag = true;
      startX = e.clientX;
      startY = e.clientY;
      document.onmousemove = move;
      document.onmouseup = stop;
    };
    function move(e) {
      if(!drag) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      furn.x += dx;
      furn.y += dy;
      startX = e.clientX;
      startY = e.clientY;
      el.style.left = furn.x + "px";
      el.style.top = furn.y + "px";
    }
    function stop() {
      drag = false;
      document.onmousemove = null;
      document.onmouseup = null;
      saveData();
    }

    // TODO: –¥–æ–±–∞–≤–∏—Ç—å –º–∞—Å—à—Ç–∞–± –∏ –≤—Ä–∞—â–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –∫–æ–ª–µ—Å–∞ –º—ã—à–∏ –∏–ª–∏ UI
  });
}

// --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–ó–∞–≥—Ä—É–∑–∫–∞ ---
function saveData() {
  localStorage.setItem("myHomeProfile", JSON.stringify(profile));
  localStorage.setItem("myHomeRooms", JSON.stringify(rooms));
}

function loadData() {
  const pr = localStorage.getItem("myHomeProfile");
  if(pr) profile = JSON.parse(pr);
  const rm = localStorage.getItem("myHomeRooms");
  if(rm) rooms = JSON.parse(rm);
}

// --- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã ---
function copyShareLink() {
  const data = {
    profile,
    rooms
  };
  const encoded = btoa(encodeURIComponent(JSON.stringify(data)));
  const url = window.location.origin + window.location.pathname + "?data=" + encoded;
  navigator.clipboard.writeText(url);
  alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –ú–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥—Ä—É–≥—É.");
}

// --- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Å—ã–ª–∫–∏ ---
function loadFromUrl() {
  const params = new URLSearchParams(window.location.search);
  if(params.has("data")) {
    try {
      const decoded = decodeURIComponent(atob(params.get("data")));
      const data = JSON.parse(decoded);
      profile = data.profile;
      rooms = data.rooms;
      currentRoomIndex = 0;
      saveData();
    } catch(e) {
      console.warn("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Å—ã–ª–∫–∏", e);
    }
  }
}

// --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
window.onload = () => {
  loadFromUrl();
  init();
};

// --- –°—Ä–∞–∑—É –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –º–µ–±–µ–ª—å ---
function updateRoomViewAndFurniture() {
  updateRoomView();
  renderRoomFurniture();
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã + –º–µ–±–µ–ª—å
function changeRoom(dir) {
  currentRoomIndex += dir;
  if(currentRoomIndex < 0) currentRoomIndex = rooms.length -1;
  if(currentRoomIndex >= rooms.length) currentRoomIndex = 0;
  updateRoomViewAndFurniture();
}

function addRoom() {
  rooms.push(createRoom());
  currentRoomIndex = rooms.length -1;
  updateRoomViewAndFurniture();
}

// –í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ–±–µ–ª–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–Ω–∞—Ç—ã
function updateRoomView() {
  roomContainer.innerHTML = "";
  rooms.forEach((room, i) => {
    const div = document.createElement("div");
    div.className = "room" + (i === currentRoomIndex ? " active" : "");
    div.style.background = room.wallpaper.color;
    div.textContent = room.name;
    div.style.position = "absolute";
    div.style.top = 0;
    div.style.left = 0;
    div.style.width = "100%";
    div.style.height = "100%";
    roomContainer.appendChild(div);
  });
  roomNameSpan.textContent = rooms[currentRoomIndex].name;
  renderRoomFurniture();
}
</script>
</body>
</html>
