<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Toca Boca World Remix ‚Äî –ß–∞—Å—Ç—å 1</title>
<style>
  /* Reset */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin:0; padding:0; height:100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f5f5;
    color: #333;
    user-select: none;
    overflow: hidden;
  }
  #app {
    position: relative;
    width: 100vw;
    height: 100vh;
    background: #e2e2e2; /* –±–∞–∑–æ–≤—ã–π —Ñ–æ–Ω */
    display: flex;
    flex-direction: column;
  }

  /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∏ –∫–æ–º–Ω–∞—Ç—ã */
  header {
    height: 50px;
    background: #d6cdc2;
    display: flex;
    align-items: center;
    padding: 0 15px;
    user-select: none;
    box-shadow: inset 0 -2px 4px rgb(0 0 0 / 0.1);
  }
  #room-name {
    flex-grow: 1;
    font-weight: 600;
    font-size: 1.2rem;
    user-select: text;
  }
  button {
    background: #b3a394;
    border: none;
    color: #fff;
    font-weight: 600;
    padding: 8px 14px;
    margin-left: 8px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  button:disabled {
    background: #aaa59a;
    cursor: default;
  }
  button:hover:not(:disabled) {
    background: #8f7e6e;
  }

  /* –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω ‚Äî –∫–æ–º–Ω–∞—Ç—ã */
  #rooms-container {
    flex-grow: 1;
    position: relative;
    background: #c3c3c3;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }
  .room {
    position: relative;
    width: 90%;
    height: 90%;
    background-color: white;
    border-radius: 18px;
    box-shadow:
      0 8px 15px rgb(0 0 0 / 0.1),
      inset 0 0 50px rgb(255 255 255 / 0.8);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  #room-title {
    height: 40px;
    background: #b6a68b;
    color: #fff;
    font-weight: 700;
    font-size: 1.1rem;
    line-height: 40px;
    padding-left: 20px;
    user-select: none;
    box-shadow: inset 0 -3px 6px rgb(0 0 0 / 0.15);
  }
  #room-furniture {
    flex-grow: 1;
    background: #f2efe8;
    position: relative;
    padding: 20px;
    overflow-y: auto;
    border-radius: 0 0 18px 18px;
  }
  #room-furniture > div {
    font-style: italic;
    color: #888;
  }

  /* –ü–∞–Ω–µ–ª–∏ –ú–µ–±–µ–ª–∏ –∏ –ü—Ä–æ—Ñ–∏–ª—è */
  #furniture-panel, #profile-panel {
    position: fixed;
    top: 50px;
    bottom: 0;
    width: 320px;
    background: #f7f1e8;
    box-shadow: 2px 0 8px rgb(0 0 0 / 0.2);
    overflow-y: auto;
    padding: 15px;
    transition: transform 0.35s ease;
    z-index: 1000;
  }
  #furniture-panel {
    left: 0;
    transform: translateX(-100%);
  }
  #furniture-panel.visible {
    transform: translateX(0);
  }
  #profile-panel {
    right: 0;
    width: 400px;
    transform: translateX(100%);
  }
  #profile-panel.visible {
    transform: translateX(0);
  }

  /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –ø–∞–Ω–µ–ª–µ–π */
  #furniture-panel > h2,
  #profile-panel > h2 {
    margin-top: 0;
    font-weight: 700;
    font-size: 1.3rem;
    border-bottom: 2px solid #a89a7d;
    padding-bottom: 10px;
    color: #6b5e44;
  }
  /* –ö–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è */
  .close-btn {
    background: transparent;
    border: none;
    font-size: 22px;
    position: absolute;
    top: 12px;
    right: 12px;
    cursor: pointer;
    color: #6b5e44;
  }
  .close-btn:hover {
    color: #3e3b2d;
  }

  /* –ö–Ω–æ–ø–∫–∏ –ú –∏ –ü –≤ –≤–µ—Ä—Ö–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É */
  #top-right-buttons {
    position: fixed;
    top: 10px;
    right: 10px;
    display: flex;
    gap: 8px;
    z-index: 1100;
  }
  #top-right-buttons button {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-weight: 700;
    font-size: 1.2rem;
    padding: 0;
    background: #b3a394;
    color: #fff;
    box-shadow: 0 2px 5px rgb(0 0 0 / 0.2);
  }
  #top-right-buttons button:hover {
    background: #8f7e6e;
  }
  #top-right-buttons button[title]:hover::after {
    content: attr(title);
    position: absolute;
    top: 48px;
    right: 0;
    background: #6b5e44;
    color: white;
    padding: 3px 8px;
    border-radius: 6px;
    font-size: 0.8rem;
    white-space: nowrap;
    user-select: none;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –º–µ–±–µ–ª–∏ (–ø–æ–∫–∞ –ø—É—Å—Ç–æ–π) */
  #furniture-list {
    margin-top: 10px;
    font-style: italic;
    color: #777;
    user-select: none;
  }

  /* –ü—Ä–æ—Ñ–∏–ª—å */
  #profile-content {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  #avatar-preview {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    font-size: 42px;
    font-weight: 700;
    color: white;
    background: #a28e6f;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    margin-bottom: 10px;
    text-transform: uppercase;
  }
  input[type="text"], input[type="color"] {
    width: 100%;
    font-size: 1.1rem;
    padding: 6px 10px;
    border-radius: 8px;
    border: 1.5px solid #b3a394;
    outline-offset: 2px;
    outline-color: #b3a394;
  }
  label {
    font-weight: 600;
    color: #6b5e44;
    user-select: none;
  }

  /* –°–µ–ª–µ–∫—Ç–æ—Ä—ã –∫–Ω–æ–ø–æ–∫ –≤ header */
  #header-buttons {
    display: flex;
    gap: 8px;
  }
</style>
</head>
<body>
<div id="app">
  <header>
    <div id="room-name">–ö–æ–º–Ω–∞—Ç–∞ 1</div>
    <div id="header-buttons">
      <button id="prev-room" title="–ü—Ä–µ–¥—ã–¥—É—â–∞—è –∫–æ–º–Ω–∞—Ç–∞" disabled>‚Üê</button>
      <button id="next-room" title="–°–ª–µ–¥—É—é—â–∞—è –∫–æ–º–Ω–∞—Ç–∞">‚Üí</button>
      <button id="add-room" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É">‚ûï</button>
    </div>
  </header>

  <main id="rooms-container" aria-label="–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–º–Ω–∞—Ç">
    <!-- –ö–æ–º–Ω–∞—Ç—ã –±—É–¥—É—Ç —Ç—É—Ç -->
  </main>

  <!-- –ü–∞–Ω–µ–ª—å –º–µ–±–µ–ª–∏ -->
  <aside id="furniture-panel" aria-label="–ü–∞–Ω–µ–ª—å –º–µ–±–µ–ª–∏" role="region" aria-hidden="true">
    <button class="close-btn" id="close-furniture" aria-label="–ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –º–µ–±–µ–ª–∏">‚úï</button>
    <h2>–ú–µ–±–µ–ª—å</h2>
    <div id="furniture-list">–ü–∞–Ω–µ–ª—å –º–µ–±–µ–ª–∏ –ø–æ–∫–∞ –ø—É—Å—Ç–∞—è</div>
  </aside>

  <!-- –ü–∞–Ω–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è -->
  <aside id="profile-panel" aria-label="–ü–∞–Ω–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è" role="region" aria-hidden="true">
    <button class="close-btn" id="close-profile" aria-label="–ó–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è">‚úï</button>
    <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <div id="profile-content">
      <div id="avatar-preview" aria-label="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">–ê</div>
      <label for="profile-nickname">–ù–∏–∫–Ω–µ–π–º (–¥–æ 25 —Å–∏–º–≤–æ–ª–æ–≤):</label>
      <input type="text" id="profile-nickname" maxlength="25" autocomplete="off" />
      <label for="profile-avatar-text">–¢–µ–∫—Å—Ç –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–µ (–¥–æ 2 —Å–∏–º–≤–æ–ª–æ–≤):</label>
      <input type="text" id="profile-avatar-text" maxlength="2" autocomplete="off" />
      <label for="profile-avatar-bgcolor">–¶–≤–µ—Ç —Ñ–æ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏:</label>
      <input type="color" id="profile-avatar-bgcolor" value="#a28e6f" />
    </div>
  </aside>

  <!-- –í–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ú –∏ –ü -->
  <div id="top-right-buttons" aria-label="–ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é">
    <button id="btn-furniture" title="–ú–µ–±–µ–ª—å (M)" aria-haspopup="true" aria-controls="furniture-panel">–ú</button>
    <button id="btn-profile" title="–ü—Ä–æ—Ñ–∏–ª—å (P)" aria-haspopup="true" aria-controls="profile-panel">–ü</button>
  </div>
</div>

<script>
  // --- –î–∞–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç ---
  const rooms = [
    {
      name: "–ö—É—Ö–Ω—è",
      wallpaper: "#ffffff",
      wallpaperPattern: "‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†",
      floorColor: "#cccccc",
      floorPattern: "||||||",
      furniture: []
    },
    {
      name: "–°–ø–∞–ª—å–Ω–∞—è",
      wallpaper: "#ffffff",
      wallpaperPattern: "‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†",
      floorColor: "#cccccc",
      floorPattern: "||||||",
      furniture: []
    },
    {
      name: "–í–∞–Ω–Ω–∞—è",
      wallpaper: "#ffffff",
      wallpaperPattern: "‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†",
      floorColor: "#cccccc",
      floorPattern: "||||||",
      furniture: []
    }
  ];
  let currentRoomIndex = 0;

  // --- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–≥–æ—Ç–æ–≤–∫–∞) ---
  const profile = {
    id: generateRandomID(),
    nickname: "",
    avatarText: "–ê",
    avatarBgColor: "#a28e6f"
  };

  // --- DOM —ç–ª–µ–º–µ–Ω—Ç—ã ---
  const roomsContainer = document.getElementById("rooms-container");
  const roomNameElem = document.getElementById("room-name");

  const prevRoomBtn = document.getElementById("prev-room");
  const nextRoomBtn = document.getElementById("next-room");
  const addRoomBtn = document.getElementById("add-room");

  const btnFurniture = document.getElementById("btn-furniture");
  const btnProfile = document.getElementById("btn-profile");

  const furniturePanel = document.getElementById("furniture-panel");
  const closeFurnitureBtn = document.getElementById("close-furniture");

  const profilePanel = document.getElementById("profile-panel");
  const profileNicknameInput = document.getElementById("profile-nickname");
  const profileAvatarTextInput = document.getElementById("profile-avatar-text");
  const profileAvatarBgColorInput = document.getElementById("profile-avatar-bgcolor");
  const avatarPreview = document.getElementById("avatar-preview");
  const closeProfileBtn = document.getElementById("close-profile");

  // === –§—É–Ω–∫—Ü–∏–∏ ===

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ ID (6 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã)
  function generateRandomID() {
    const chars = "abcdefghijklmnopqrstuvwxyz0123456789";
    let id = "";
    for (let i = 0; i < 6; i++) {
      id += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return id;
  }

  // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
  function updateAvatarPreview() {
    let text = profileAvatarTextInput.value.trim();
    if (text.length === 0) text = "–ê";
    avatarPreview.textContent = text;
    avatarPreview.style.backgroundColor = profileAvatarBgColorInput.value;
  }

  // –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–º–Ω–∞—Ç—É
  function renderCurrentRoom() {
    roomsContainer.innerHTML = ""; // –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

    const room = rooms[currentRoomIndex];

    // –°–æ–∑–¥–∞–µ–º –¥–∏–≤ –∫–æ–º–Ω–∞—Ç—ã
    const roomDiv = document.createElement("div");
    roomDiv.classList.add("room");
    roomDiv.setAttribute("aria-label", "–ö–æ–º–Ω–∞—Ç–∞ " + room.name);

    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ–Ω –æ–±–æ–µ–≤ –∏ –ø–æ–ª–∞ (–ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ —Ü–≤–µ—Ç —Å—Ç–µ–Ω—ã –∏ –ø–æ–ª–∞)
    roomDiv.style.backgroundColor = room.wallpaper;

    // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
    const roomTitle = document.createElement("div");
    roomTitle.id = "room-title";
    roomTitle.textContent = room.name;
    roomDiv.appendChild(roomTitle);

    // –ú–µ–±–µ–ª—å –≤ –∫–æ–º–Ω–∞—Ç–µ (–ø–æ–∫–∞ –ø—É—Å—Ç–æ)
    const furnitureContainer = document.createElement("div");
    furnitureContainer.id = "room-furniture";

    const emptyMsg = document.createElement("div");
    emptyMsg.textContent = "–í –∫–æ–º–Ω–∞—Ç–µ –ø–æ–∫–∞ –Ω–µ—Ç –º–µ–±–µ–ª–∏.";
    emptyMsg.style.color = "#7a7a7a";
    emptyMsg.style.fontStyle = "italic";
    furnitureContainer.appendChild(emptyMsg);

    roomDiv.appendChild(furnitureContainer);

    roomsContainer.appendChild(roomDiv);

    // –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –≤ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏
    roomNameElem.textContent = room.name;

    updateRoomButtonsState();
  }

  // –û–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç
  function updateRoomButtonsState() {
    prevRoomBtn.disabled = currentRoomIndex === 0;
    nextRoomBtn.disabled = currentRoomIndex === rooms.length - 1;
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
  function changeRoom(direction) {
    if (direction === "next" && currentRoomIndex < rooms.length - 1) {
      currentRoomIndex++;
    } else if (direction === "prev" && currentRoomIndex > 0) {
      currentRoomIndex--;
    }
    renderCurrentRoom();
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç—ã
  function addRoom() {
    const defaultName = "–ù–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞";
    const newRoom = {
      name: defaultName,
      wallpaper: "#ffffff",
      wallpaperPattern: "‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†",
      floorColor: "#cccccc",
      floorPattern: "||||||",
      furniture: []
    };
    rooms.push(newRoom);
    currentRoomIndex = rooms.length - 1;
    renderCurrentRoom();
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å / —Å–∫—Ä—ã—Ç—å –º–µ–±–µ–ª—å
  function toggleFurniturePanel() {
    if (furniturePanel.classList.contains("visible")) {
      furniturePanel.classList.remove("visible");
      furniturePanel.setAttribute("aria-hidden", "true");
    } else {
      furniturePanel.classList.add("visible");
      furniturePanel.setAttribute("aria-hidden", "false");
      // –ó–∞–∫—Ä–æ–µ–º –ø—Ä–æ—Ñ–∏–ª—å –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç
      profilePanel.classList.remove("visible");
      profilePanel.setAttribute("aria-hidden", "true");
    }
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å / —Å–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
  function toggleProfilePanel() {
    if (profilePanel.classList.contains("visible")) {
      profilePanel.classList.remove("visible");
      profilePanel.setAttribute("aria-hidden", "true");
    } else {
      profilePanel.classList.add("visible");
      profilePanel.setAttribute("aria-hidden", "false");
      // –ó–∞–∫—Ä–æ–µ–º –º–µ–±–µ–ª—å –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç
      furniturePanel.classList.remove("visible");
      furniturePanel.setAttribute("aria-hidden", "true");
    }
  }

  // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ –∏–Ω–ø—É—Ç–æ–≤
  function updateProfileFromInputs() {
    profile.nickname = profileNicknameInput.value.trim().substring(0, 25);
    profile.avatarText = profileAvatarTextInput.value.trim().substring(0, 2) || "–ê";
    profile.avatarBgColor = profileAvatarBgColorInput.value;

    updateAvatarPreview();
  }

  // --- –°–æ–±—ã—Ç–∏—è ---
  prevRoomBtn.addEventListener("click", () => changeRoom("prev"));
  nextRoomBtn.addEventListener("click", () => changeRoom("next"));
  addRoomBtn.addEventListener("click", () => addRoom());

  btnFurniture.addEventListener("click", () => toggleFurniturePanel());
  btnProfile.addEventListener("click", () => toggleProfilePanel());

  closeFurnitureBtn.addEventListener("click", () => {
    furniturePanel.classList.remove("visible");
    furniturePanel.setAttribute("aria-hidden", "true");
  });

  closeProfileBtn.addEventListener("click", () => {
    profilePanel.classList.remove("visible");
    profilePanel.setAttribute("aria-hidden", "true");
  });

  profileNicknameInput.addEventListener("input", updateProfileFromInputs);
  profileAvatarTextInput.addEventListener("input", updateProfileFromInputs);
  profileAvatarBgColorInput.addEventListener("input", updateProfileFromInputs);

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫–æ–º–Ω–∞—Ç —Å—Ç—Ä–µ–ª–∫–∞–º–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
  document.addEventListener("keydown", (e) => {
    if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA") return;
    if (e.key === "ArrowLeft") changeRoom("prev");
    if (e.key === "ArrowRight") changeRoom("next");
    if (e.key.toLowerCase() === "m") toggleFurniturePanel();
    if (e.key.toLowerCase() === "p") toggleProfilePanel();
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  renderCurrentRoom();
  updateAvatarPreview();
</script>
<script>
// --- –ú–µ–±–µ–ª—å ---

// –ü—Ä–∏–º–µ—Ä –±–∞–∑—ã –º–µ–±–µ–ª–∏ (id, –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–∏–ø, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ —Å—Ç–∏–ª—å)
const furnitureCatalog = [
  {
    id: "chair01",
    name: "–ö—Ä–µ—Å–ª–æ",
    type: "seat",
    texture: "ü™ë", // –í –±—É–¥—É—â–µ–º –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è/—Å–ø—Ä–∞–π—Ç—ã
  },
  {
    id: "table01",
    name: "–°—Ç–æ–ª",
    type: "table",
    texture: "üõãÔ∏è",
  },
  {
    id: "lamp01",
    name: "–õ–∞–º–ø–∞",
    type: "light",
    texture: "üí°",
  },
  {
    id: "rug01",
    name: "–ö–æ–≤–µ—Ä",
    type: "floorDecoration",
    texture: "üß∏",
  },
  {
    id: "bed01",
    name: "–ö—Ä–æ–≤–∞—Ç—å",
    type: "bed",
    texture: "üõèÔ∏è",
  },
];

// –û–±—ä–µ–∫—Ç —Å —Ç–µ–∫—É—â–µ–π –º–µ–±–µ–ª—å—é –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–Ω–∞—Ç—ã
// rooms[currentRoomIndex].furniture –±—É–¥–µ—Ç –º–∞—Å—Å–∏–≤–æ–º –æ–±—ä–µ–∫—Ç–æ–≤ —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–π –º–µ–±–µ–ª—å—é
// –ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç –º–µ–±–µ–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ —Å–æ–¥–µ—Ä–∂–∏—Ç: id, x, y, rotation (0, 90, 180, 270), layer
// –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø–æ–∑–∏—Ü–∏—è x,y - –≤ –ø–∏–∫—Å–µ–ª—è—Ö –∏–ª–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (–ø–æ–∑–∂–µ —É—Ç–æ—á–Ω–∏–º)

function createFurnitureInstance(catalogItem) {
  return {
    id: catalogItem.id,
    name: catalogItem.name,
    type: catalogItem.type,
    texture: catalogItem.texture,
    x: 50, // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ —Ü–µ–Ω—Ç—Ä—É –∫–æ–º–Ω–∞—Ç—ã
    y: 50,
    rotation: 0,
    layer: 0,
  };
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–µ–±–µ–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ
function renderFurniture() {
  const room = rooms[currentRoomIndex];
  const furnitureContainer = document.getElementById("furnitureContainer");
  furnitureContainer.innerHTML = ""; // –û—á–∏—Å—Ç–∏—Ç—å

  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ layer, —á—Ç–æ–±—ã —Ä–∏—Å–æ–≤–∞—Ç—å —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö
  const sortedFurniture = [...room.furniture].sort((a, b) => a.layer - b.layer);

  sortedFurniture.forEach((item, index) => {
    const div = document.createElement("div");
    div.classList.add("furniture-item");
    div.style.position = "absolute";
    div.style.left = item.x + "%";
    div.style.top = item.y + "%";
    div.style.transform = `rotate(${item.rotation}deg)`;
    div.style.zIndex = 100 + item.layer; // —á—Ç–æ–±—ã —Å–ª–æ–∏ –±—ã–ª–∏ –≤—ã—à–µ —Ñ–æ–Ω–∞

    div.textContent = item.texture;
    div.title = item.name;

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞
    div.addEventListener("click", (e) => {
      e.stopPropagation();
      selectFurniture(index);
    });

    furnitureContainer.appendChild(div);
  });
}

// –í—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–µ–±–µ–ª–∏ (–∏–Ω–¥–µ–∫—Å –≤ –º–∞—Å—Å–∏–≤–µ current –∫–æ–º–Ω–∞—Ç—ã)
let selectedFurnitureIndex = null;

function selectFurniture(index) {
  selectedFurnitureIndex = index;
  renderFurnitureControls();
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–µ–±–µ–ª—å—é
function renderFurnitureControls() {
  const controls = document.getElementById("furnitureControls");
  controls.innerHTML = "";

  if (selectedFurnitureIndex === null) {
    controls.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–±–µ–ª—å –≤ –∫–æ–º–Ω–∞—Ç–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.";
    return;
  }

  const room = rooms[currentRoomIndex];
  const item = room.furniture[selectedFurnitureIndex];

  const info = document.createElement("div");
  info.textContent = `–í—ã–±—Ä–∞–Ω–∞: ${item.name}`;
  controls.appendChild(info);

  // –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–Ω—è—Ç—å —Å–ª–æ–π
  const btnUp = document.createElement("button");
  btnUp.textContent = "–ü–æ–¥–Ω—è—Ç—å —Å–ª–æ–π";
  btnUp.addEventListener("click", () => {
    if (item.layer < 100) {
      item.layer++;
      renderFurniture();
      renderFurnitureControls();
    }
  });
  controls.appendChild(btnUp);

  // –ö–Ω–æ–ø–∫–∞ –æ–ø—É—Å—Ç–∏—Ç—å —Å–ª–æ–π
  const btnDown = document.createElement("button");
  btnDown.textContent = "–û–ø—É—Å—Ç–∏—Ç—å —Å–ª–æ–π";
  btnDown.addEventListener("click", () => {
    if (item.layer > 0) {
      item.layer--;
      renderFurniture();
      renderFurnitureControls();
    }
  });
  controls.appendChild(btnDown);

  // –ü–æ–≤–æ—Ä–æ—Ç –≤–ª–µ–≤–æ
  const btnRotateLeft = document.createElement("button");
  btnRotateLeft.textContent = "–ü–æ–≤–µ—Ä–Ω—É—Ç—å –≤–ª–µ–≤–æ";
  btnRotateLeft.addEventListener("click", () => {
    item.rotation = (item.rotation - 90 + 360) % 360;
    renderFurniture();
    renderFurnitureControls();
  });
  controls.appendChild(btnRotateLeft);

  // –ü–æ–≤–æ—Ä–æ—Ç –≤–ø—Ä–∞–≤–æ
  const btnRotateRight = document.createElement("button");
  btnRotateRight.textContent = "–ü–æ–≤–µ—Ä–Ω—É—Ç—å –≤–ø—Ä–∞–≤–æ";
  btnRotateRight.addEventListener("click", () => {
    item.rotation = (item.rotation + 90) % 360;
    renderFurniture();
    renderFurnitureControls();
  });
  controls.appendChild(btnRotateRight);

  // –£–¥–∞–ª–∏—Ç—å –º–µ–±–µ–ª—å
  const btnDelete = document.createElement("button");
  btnDelete.textContent = "–£–¥–∞–ª–∏—Ç—å –º–µ–±–µ–ª—å";
  btnDelete.addEventListener("click", () => {
    room.furniture.splice(selectedFurnitureIndex, 1);
    selectedFurnitureIndex = null;
    renderFurniture();
    renderFurnitureControls();
  });
  controls.appendChild(btnDelete);
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–±–µ–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç—É –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
function addFurnitureById(furnitureId) {
  const catalogItem = furnitureCatalog.find((f) => f.id === furnitureId);
  if (!catalogItem) return;

  const newFurniture = createFurnitureInstance(catalogItem);
  rooms[currentRoomIndex].furniture.push(newFurniture);
  selectedFurnitureIndex = rooms[currentRoomIndex].furniture.length - 1;

  renderFurniture();
  renderFurnitureControls();
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –º–µ–±–µ–ª–∏ –≤ –ø–∞–Ω–µ–ª–∏ –º–µ–±–µ–ª–∏
function renderFurnitureCatalog() {
  const catalogContainer = document.getElementById("furnitureCatalog");
  catalogContainer.innerHTML = "";

  furnitureCatalog.forEach((item) => {
    const btn = document.createElement("button");
    btn.classList.add("furniture-catalog-item");
    btn.textContent = item.name + " " + item.texture;
    btn.title = item.name;

    btn.addEventListener("click", () => {
      addFurnitureById(item.id);
    });

    catalogContainer.appendChild(btn);
  });
}

// –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º–µ–±–µ–ª–∏ –º—ã—à–∫–æ–π (–ø—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞)
let dragFurnitureIndex = null;
let dragOffsetX = 0;
let dragOffsetY = 0;

const furnitureContainer = document.getElementById("furnitureContainer");

furnitureContainer.addEventListener("mousedown", (e) => {
  const target = e.target;
  if (!target.classList.contains("furniture-item")) return;

  // –ù–∞–π—Ç–∏ –∏–Ω–¥–µ–∫—Å –º–µ–±–µ–ª–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
  const children = Array.from(furnitureContainer.children);
  const index = children.indexOf(target);

  if (index === -1) return;

  dragFurnitureIndex = index;
  const rect = target.getBoundingClientRect();
  dragOffsetX = e.clientX - rect.left;
  dragOffsetY = e.clientY - rect.top;

  document.body.style.userSelect = "none"; // –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
});

document.addEventListener("mouseup", () => {
  dragFurnitureIndex = null;
  document.body.style.userSelect = "auto";
});

document.addEventListener("mousemove", (e) => {
  if (dragFurnitureIndex === null) return;

  const room = rooms[currentRoomIndex];
  const item = room.furniture[dragFurnitureIndex];

  // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  const containerRect = furnitureContainer.getBoundingClientRect();
  let newX = ((e.clientX - containerRect.left - dragOffsetX) / containerRect.width) * 100;
  let newY = ((e.clientY - containerRect.top - dragOffsetY) / containerRect.height) * 100;

  // –û–≥—Ä–∞–Ω–∏—á–∏–º, —á—Ç–æ–±—ã –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç—å –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
  newX = Math.min(95, Math.max(0, newX));
  newY = Math.min(95, Math.max(0, newY));

  item.x = newX;
  item.y = newY;

  renderFurniture();
  renderFurnitureControls();
});

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–Ω–¥–µ—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ –º–µ–±–µ–ª–∏
renderFurnitureCatalog();
renderFurniture();

</script>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–±–µ–ª–∏ */
#furnitureContainer {
  position: relative;
  width: 100%;
  height: 60vh;
  border: 2px solid #ccc;
  background-color: #e0e0e0;
  margin-top: 10px;
  overflow: hidden;
  user-select: none;
}

.furniture-item {
  cursor: pointer;
  font-size: 24px;
  transition: transform 0.2s ease;
  user-select: none;
  width: 40px;
  height: 40px;
  text-align: center;
  line-height: 40px;
  border-radius: 6px;
  background-color: rgba(255 255 255 / 0.8);
  box-shadow: 0 0 3px rgba(0,0,0,0.2);
  position: absolute;
}

#furnitureControls {
  margin-top: 10px;
  padding: 10px;
  background-color: #f0f0f5;
  border-radius: 8px;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
  min-height: 130px;
}

#furnitureCatalog {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 10px;
}

.furniture-catalog-item {
  padding: 6px 12px;
  background-color: #d8e3f0;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  user-select: none;
  transition: background-color 0.3s ease;
}

.furniture-catalog-item:hover {
  background-color: #a8c1ff;
}
</style>
<script>
// --- –û–±–æ–∏ –∏ –ø–æ–ª—ã ---

// –£–∑–æ—Ä—ã –æ–±–æ–µ–≤ (–Ω–∞–∑–≤–∞–Ω–∏–µ + —Å–∏–º–≤–æ–ª—ã –¥–ª—è —Ç–µ–∫—Å—Ç—É—Ä—ã)
const wallpaperPatterns = {
  "denseSquares": "‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†",
  "circlesWithGaps": "‚óç ‚óç ‚óç ‚óç",
  "rareSymbols": "ÍôÆ ÍôÆ ÍôÆ",
  "densePatterns": "‚Üà‚Üà‚Üà‚Üà‚Üà",
  "stars": "‚Äª ‚Äª ‚Äª ‚Äª",
  "verticalCircles": "‚óØ\n‚óØ\n‚óØ",
  "semiCircles": "‚à™ ‚à™ ‚à™ ‚à™",
};

// –£–∑–æ—Ä—ã –ø–æ–ª–∞
const floorPatterns = {
  "woodenBoards": "||||||||",
  "stones": "‚®∑ ‚®∑ ‚®∑",
  "carpet": ":::::::",
  "tiles": "‚ß´ ‚ß´ ‚ß´ ‚ß´",
  "softGradient": "‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë",
  "waves": "‚âà‚âà‚âà‚âà‚âà",
};

// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –∫–æ–º–Ω–∞—Ç–∞—Ö —É–∂–µ –µ—Å—Ç—å –æ–±–æ–∏ –∏ –ø–æ–ª (–≤ rooms[currentRoomIndex])

// –ü–æ–ª—É—á–∏—Ç—å DOM —ç–ª–µ–º–µ–Ω—Ç—ã –≤—ã–±–æ—Ä–∞
const wallpaperPatternSelect = document.getElementById("wallpaperPatternSelect");
const wallpaperColorInput = document.getElementById("wallpaperColorInput");
const wallpaperPatternColorInput = document.getElementById("wallpaperPatternColorInput");

const floorPatternSelect = document.getElementById("floorPatternSelect");
const floorColorInput = document.getElementById("floorColorInput");

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ–≤ —É–∑–æ—Ä–æ–≤
function initPatternSelectors() {
  // –û–±–æ–∏
  Object.entries(wallpaperPatterns).forEach(([key, val]) => {
    const option = document.createElement("option");
    option.value = key;
    option.textContent = key;
    wallpaperPatternSelect.appendChild(option);
  });

  // –ü–æ–ª—ã
  Object.entries(floorPatterns).forEach(([key, val]) => {
    const option = document.createElement("option");
    option.value = key;
    option.textContent = key;
    floorPatternSelect.appendChild(option);
  });
}

// –û–±–Ω–æ–≤–∏—Ç—å –æ–±–æ–∏ –∫–æ–º–Ω–∞—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É
function updateWallpaper() {
  const room = rooms[currentRoomIndex];
  room.wallpaperPattern = wallpaperPatternSelect.value;
  room.wallpaperColor = wallpaperColorInput.value;
  room.wallpaperPatternColor = wallpaperPatternColorInput.value;

  renderRoomBackground();
}

// –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª –∫–æ–º–Ω–∞—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É
function updateFloor() {
  const room = rooms[currentRoomIndex];
  room.floorPattern = floorPatternSelect.value;
  room.floorColor = floorColorInput.value;

  renderRoomBackground();
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–∞ –∫–æ–º–Ω–∞—Ç—ã (–æ–±–æ–∏ –∏ –ø–æ–ª)
function renderRoomBackground() {
  const room = rooms[currentRoomIndex];

  // –ó–∞–¥–Ω–∏–π —Ñ–æ–Ω ‚Äî –æ–±–æ–∏ (—É–∑–æ—Ä + —Ü–≤–µ—Ç)
  const wallpaperDiv = document.getElementById("wallpaperBackground");
  const wallpaperPattern = wallpaperPatterns[room.wallpaperPattern] || wallpaperPatterns["denseSquares"];
  wallpaperDiv.style.color = room.wallpaperPatternColor || "#999";
  wallpaperDiv.style.backgroundColor = room.wallpaperColor || "#fff";

  // –ü–∏—à–µ–º –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è —É–∑–æ—Ä (–ø—Ä–æ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Å–∏–º–≤–æ–ª—ã –≤ –±–ª–æ–∫–µ)
  wallpaperDiv.textContent = wallpaperPattern.repeat(50);

  // –ü–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ —Ü–≤–µ—Ç–∞
  wallpaperDiv.style.transition = "background-color 0.5s ease, color 0.5s ease";

  // –ü–æ–ª
  const floorDiv = document.getElementById("floorBackground");
  const floorPattern = floorPatterns[room.floorPattern] || floorPatterns["woodenBoards"];
  floorDiv.style.color = "#6b4c3b"; // –±–∞–∑–æ–≤—ã–π —Ü–≤–µ—Ç —É–∑–æ—Ä–∞ –ø–æ–ª–∞, –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å
  floorDiv.style.backgroundColor = room.floorColor || "#ccc";

  floorDiv.textContent = floorPattern.repeat(50);
  floorDiv.style.transition = "background-color 0.5s ease, color 0.5s ease";
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞
wallpaperPatternSelect.addEventListener("change", updateWallpaper);
wallpaperColorInput.addEventListener("input", updateWallpaper);
wallpaperPatternColorInput.addEventListener("input", updateWallpaper);

floorPatternSelect.addEventListener("change", updateFloor);
floorColorInput.addEventListener("input", updateFloor);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
initPatternSelectors();

// –ó–∞–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–æ–≤ –∏ –∏–Ω–ø—É—Ç–æ–≤ –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–º–Ω–∞—Ç—ã
function loadRoomPatternsToControls() {
  const room = rooms[currentRoomIndex];

  wallpaperPatternSelect.value = room.wallpaperPattern || "denseSquares";
  wallpaperColorInput.value = room.wallpaperColor || "#ffffff";
  wallpaperPatternColorInput.value = room.wallpaperPatternColor || "#999999";

  floorPatternSelect.value = room.floorPattern || "woodenBoards";
  floorColorInput.value = room.floorColor || "#cccccc";
}

loadRoomPatternsToControls();
renderRoomBackground();

</script>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±–æ–µ–≤ –∏ –ø–æ–ª–∞ */
#wallpaperBackground {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 65%;
  overflow: hidden;
  font-size: 24px;
  line-height: 24px;
  user-select: none;
  white-space: nowrap;
  word-wrap: normal;
  letter-spacing: 2px;
  opacity: 0.3;
  pointer-events: none;
}

#floorBackground {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 35%;
  overflow: hidden;
  font-size: 28px;
  line-height: 28px;
  user-select: none;
  white-space: nowrap;
  word-wrap: normal;
  letter-spacing: 4px;
  opacity: 0.4;
  pointer-events: none;
}

/* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–æ—è–º–∏ –∏ –ø–æ–ª–æ–º */
#wallpaperControls, #floorControls {
  margin-top: 15px;
  background-color: #fafafa;
  padding: 10px;
  border-radius: 10px;
  box-shadow: inset 0 0 8px #ddd;
  max-width: 480px;
  font-family: Arial, sans-serif;
}

label {
  display: block;
  margin-top: 8px;
  font-weight: 600;
  color: #444;
}

input[type=color], select {
  margin-top: 4px;
  padding: 5px;
  width: 100%;
  box-sizing: border-box;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 16px;
}
</style>

<!-- HTML –¥–ª—è –ø–∞–Ω–µ–ª–∏ –æ–±–æ–µ–≤ –∏ –ø–æ–ª–∞ -->
<div id="wallpaperBackground"></div>
<div id="floorBackground"></div>

<div id="wallpaperControls">
  <h3>–û–±–æ–∏</h3>
  <label for="wallpaperPatternSelect">–£–∑–æ—Ä:</label>
  <select id="wallpaperPatternSelect"></select>
  <label for="wallpaperColorInput">–¶–≤–µ—Ç –æ–±–æ–µ–≤:</label>
  <input type="color" id="wallpaperColorInput" value="#ffffff" />
  <label for="wallpaperPatternColorInput">–¶–≤–µ—Ç —É–∑–æ—Ä–∞:</label>
  <input type="color" id="wallpaperPatternColorInput" value="#999999" />
</div>

<div id="floorControls">
  <h3>–ü–æ–ª</h3>
  <label for="floorPatternSelect">–£–∑–æ—Ä –ø–æ–ª–∞:</label>
  <select id="floorPatternSelect"></select>
  <label for="floorColorInput">–¶–≤–µ—Ç –ø–æ–ª–∞:</label>
  <input type="color" id="floorColorInput" value="#cccccc" />
</div>
<!-- 4-—è —á–∞—Å—Ç—å: –ü—Ä–æ—Ñ–∏–ª—å, –î—Ä—É–∑—å—è, –°—Å—ã–ª–∫–∞, –ú—É–∑—ã–∫–∞ -->

<!-- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
<style>
  /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è */
  #profileOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(6px);
    display: none;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #333;
    z-index: 1000;
  }

  #profileHeader {
    width: 100%;
    max-width: 600px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  #profileHeader h2 {
    margin: 0;
    font-weight: 700;
    font-size: 1.8rem;
  }

  #profileCloseBtn {
    cursor: pointer;
    font-size: 1.5rem;
    padding: 5px 10px;
    border: none;
    background: #e3e3e3;
    border-radius: 8px;
    transition: background-color 0.3s ease;
  }
  #profileCloseBtn:hover {
    background: #cfcfcf;
  }

  /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ñ–∏–ª—è */
  #profileNav {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  #profileNav button {
    background: #ececec;
    border: none;
    border-radius: 6px;
    padding: 8px 14px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }
  #profileNav button.active,
  #profileNav button:hover {
    background: #b6d7a8;
    color: #2f521e;
  }

  /* –°–µ–∫—Ü–∏–∏ */
  .profileSection {
    width: 100%;
    max-width: 600px;
    display: none;
    flex-direction: column;
    gap: 15px;
  }
  .profileSection.active {
    display: flex;
  }

  /* –ê–≤–∞—Ç–∞—Ä–∫–∞ */
  #avatarPreview {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    font-size: 50px;
    color: #fff;
    text-align: center;
    line-height: 100px;
    user-select: none;
    font-weight: 700;
    margin-bottom: 10px;
    position: relative;
  }

  /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏ */
  #avatarBgColor {
    width: 100%;
    max-width: 150px;
    height: 36px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
  }

  /* –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è —Å–∏–º–≤–æ–ª–æ–≤ –∞–≤–∞—Ç–∞—Ä–∫–∏ */
  #avatarSymbolInput {
    width: 100%;
    max-width: 150px;
    padding: 6px 8px;
    font-size: 28px;
    font-weight: 700;
    border: 2px solid #b6d7a8;
    border-radius: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
    user-select: text;
  }

  /* –ù–∏–∫–Ω–µ–π–º */
  #nicknameInput {
    padding: 6px 8px;
    font-size: 18px;
    border-radius: 8px;
    border: 2px solid #b6d7a8;
    max-width: 300px;
  }

  /* ID –∏ –∫–Ω–æ–ø–∫–∏ */
  #profileIdSection {
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: monospace;
    font-size: 14px;
    margin-top: 6px;
  }

  .btnSmall {
    background: #b6d7a8;
    border: none;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    color: #2f521e;
    transition: background-color 0.3s ease;
  }
  .btnSmall:hover {
    background: #94b66d;
  }

  /* –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π */
  #friendsList {
    max-height: 280px;
    overflow-y: auto;
    border: 1px solid #c4d6a6;
    border-radius: 10px;
    padding: 10px;
    background: #f9fcef;
  }
  .friendItem {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 6px 8px;
    border-radius: 8px;
    background: #e6f1d5;
    margin-bottom: 8px;
  }
  .friendAvatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    font-weight: 700;
    font-size: 24px;
    color: white;
    text-align: center;
    line-height: 48px;
    user-select: none;
    flex-shrink: 0;
  }
  .friendInfo {
    flex-grow: 1;
    font-weight: 600;
  }
  .friendButtons {
    display: flex;
    gap: 8px;
  }
  .friendButtons button {
    background: #a3c87f;
    border: none;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 12px;
    color: #2f521e;
    transition: background-color 0.3s ease;
  }
  .friendButtons button:hover {
    background: #7aa23d;
  }

  /* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∞ */
  #addFriendSection {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    align-items: center;
  }
  #addFriendInput {
    flex-grow: 1;
    padding: 6px 8px;
    font-size: 16px;
    border-radius: 8px;
    border: 2px solid #b6d7a8;
  }
  #addFriendBtn {
    padding: 8px 14px;
    font-weight: 700;
    border-radius: 8px;
    border: none;
    background: #94b66d;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #addFriendBtn:hover:not(:disabled) {
    background: #7aa23d;
  }
  #addFriendBtn:disabled {
    background: #b6d7a8;
    cursor: default;
  }

  /* –°–æ–æ–±—â–µ–Ω–∏—è */
  #profileMessage {
    margin-top: 10px;
    font-weight: 600;
    font-size: 14px;
    color: #3b6619;
  }

  /* –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É */
  #linkSection {
    margin-top: 15px;
    padding: 10px;
    background: #d9e8b9;
    border-radius: 10px;
    font-family: monospace;
    word-break: break-all;
    user-select: all;
  }
  #generateLinkBtn {
    margin-top: 10px;
    padding: 8px 14px;
    border: none;
    border-radius: 8px;
    background: #7aa23d;
    color: white;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s ease;
  }
  #generateLinkBtn:hover {
    background: #59812a;
  }

  /* –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä */
  #musicPlayer {
    margin-top: 20px;
    background: #eef4de;
    padding: 12px 20px;
    border-radius: 12px;
    max-width: 600px;
  }
  #musicControls {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  #musicSelect {
    flex-grow: 1;
    padding: 6px 8px;
    font-size: 16px;
    border-radius: 8px;
    border: 2px solid #b6d7a8;
  }
  #musicVolume {
    width: 100px;
  }
  #musicButtons button {
    padding: 8px 14px;
    border: none;
    border-radius: 8px;
    background: #94b66d;
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #musicButtons button:hover {
    background: #7aa23d;
  }
</style>

<!-- –û–∫–Ω–æ –ü—Ä–æ—Ñ–∏–ª—è -->
<div id="profileOverlay" aria-hidden="true" role="dialog" aria-modal="true" aria-label="–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
  <div id="profileHeader">
    <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
    <button id="profileCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">&times;</button>
  </div>

  <nav id="profileNav" role="tablist" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø—Ä–æ—Ñ–∏–ª—é">
    <button id="tabProfileBtn" role="tab" aria-selected="true" tabindex="0">–ü—Ä–æ—Ñ–∏–ª—å</button>
    <button id="tabFriendsBtn" role="tab" aria-selected="false" tabindex="-1">–î—Ä—É–∑—å—è</button>
    <button id="tabIDBtn" role="tab" aria-selected="false" tabindex="-1">ID</button>
  </nav>

  <!-- –°–µ–∫—Ü–∏–∏ -->
  <section id="profileSection" class="profileSection active" role="tabpanel" tabindex="0" aria-labelledby="tabProfileBtn">
    <div>
      <div id="avatarPreview" aria-label="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∞–≤–∞—Ç–∞—Ä–∫–∏" tabindex="0" role="img"></div>

      <label for="avatarSymbolInput">–¢–µ–∫—Å—Ç –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–µ (–º–∞–∫—Å 2 —Å–∏–º–≤–æ–ª–∞):</label>
      <input type="text" id="avatarSymbolInput" maxlength="2" aria-describedby="avatarSymbolDesc" autocomplete="off" autocorrect="off" autocapitalize="characters" spellcheck="false"/>

      <small id="avatarSymbolDesc">–ú–æ–∂–Ω–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏–ª–∏ —Å—Ç–∏–∫–µ—Ä—ã</small>

      <label for="avatarBgColor">–¶–≤–µ—Ç —Ñ–æ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏:</label>
      <input type="color" id="avatarBgColor" value="#94b66d" aria-describedby="avatarBgColorDesc" />
      <small id="avatarBgColorDesc">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏</small>
    </div>

    <div>
      <label for="nicknameInput">–ù–∏–∫–Ω–µ–π–º (–º–∞–∫—Å 25 —Å–∏–º–≤–æ–ª–æ–≤):</label>
      <input type="text" id="nicknameInput" maxlength="25" aria-describedby="nicknameDesc" autocomplete="off" autocorrect="off" autocapitalize="words" spellcheck="false" />
      <small id="nicknameDesc">–ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–µ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ —á–∞—Å</small>
    </div>

    <div id="profileIdSection" aria-live="polite" aria-atomic="true">
      <span>ID: <span id="profileIDText"></span></span>
      <button class="btnSmall" id="copyProfileIDBtn" aria-label="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID –ø—Ä–æ—Ñ–∏–ª—è">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID</button>
    </div>

    <button id="saveProfileBtn" class="btnSmall" aria-label="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>

    <div id="profileMessage" role="alert" aria-live="assertive"></div>

    <div id="linkSection" aria-label="–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É">
      <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É:</label>
      <textarea id="apartmentLink" rows="2" readonly style="width:100%; resize:none; border-radius:8px; border: 2px solid #b6d7a8; padding:8px; font-family: monospace;"></textarea>
      <button id="generateLinkBtn" aria-label="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
    </div>
  </section>

  <section id="friendsSection" class="profileSection" role="tabpanel" tabindex="0" aria-labelledby="tabFriendsBtn">
    <h3>–î—Ä—É–∑—å—è</h3>

    <div id="friendsList" aria-live="polite" aria-relevant="additions removals"></div>

    <div id="addFriendSection">
      <input type="text" id="addFriendInput" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞" aria-label="ID –¥—Ä—É–≥–∞" autocomplete="off" />
      <button id="addFriendBtn" disabled>–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</button>
    </div>

    <div id="friendsMessage" role="alert" aria-live="assertive"></div>
  </section>

  <section id="idSection" class="profileSection" role="tabpanel" tabindex="0" aria-labelledby="tabIDBtn">
    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è</h3>
    <p><strong>–ù–∏–∫–Ω–µ–π–º:</strong> <span id="idNickname"></span></p>
    <p><strong>ID:</strong> <span id="idID"></span></p>
    <p><strong>–ê–≤–∞—Ç–∞—Ä–∫–∞:</strong></p>
    <div id="idAvatar" style="width: 80px; height: 80px; border-radius: 50%; font-weight: 700; font-size: 40px; color: white; text-align: center; line-height: 80px; user-select: none;"></div>
  </section>

  <section id="musicSection" class="profileSection" role="tabpanel" tabindex="0" aria-labelledby="tabMusicBtn" style="display:none;">
    <!-- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ -->
  </section>

  <!-- –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä –≤–Ω–∏–∑—É –ø—Ä–æ—Ñ–∏–ª—è -->
  <div id="musicPlayer" aria-label="–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä">
    <select id="musicSelect" aria-label="–í—ã–±–æ—Ä –ø–µ—Å–Ω–∏">
      <option value="1.mp3">–ü–µ—Å–Ω—è 1</option>
      <option value="2.mp3">–ü–µ—Å–Ω—è 2</option>
      <option value="3.mp3">–ü–µ—Å–Ω—è 3</option>
      <option value="4.mp3">–ü–µ—Å–Ω—è 4</option>
      <option value="5.mp3">–ü–µ—Å–Ω—è 5</option>
    </select>
    <input id="musicVolume" type="range" min="0" max="1" step="0.01" aria-label="–ì—Ä–æ–º–∫–æ—Å—Ç—å" value="0.5"/>
    <div id="musicButtons">
      <button id="musicPlayBtn" aria-label="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –º—É–∑—ã–∫—É">‚ñ∂</button>
      <button id="musicPauseBtn" aria-label="–ü–∞—É–∑–∞">‚è∏</button>
      <button id="musicRandomBtn" aria-label="–°–ª—É—á–∞–π–Ω–∞—è –ø–µ—Å–Ω—è">üîÄ</button>
    </div>
  </div>
</div>

<script>
(() => {
  // –ö–ª—é—á–∏ –¥–ª—è localStorage
  const STORAGE_PROFILE = 'tbw_profile';
  const STORAGE_FRIENDS = 'tbw_friends';
  const STORAGE_APARTMENT = 'tbw_apartment';

  // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  const profileOverlay = document.getElementById('profileOverlay');
  const profileCloseBtn = document.getElementById('profileCloseBtn');

  const tabProfileBtn = document.getElementById('tabProfileBtn');
  const tabFriendsBtn = document.getElementById('tabFriendsBtn');
  const tabIDBtn = document.getElementById('tabIDBtn');

  const profileSection = document.getElementById('profileSection');
  const friendsSection = document.getElementById('friendsSection');
  const idSection = document.getElementById('idSection');

  const avatarPreview = document.getElementById('avatarPreview');
  const avatarSymbolInput = document.getElementById('avatarSymbolInput');
  const avatarBgColor = document.getElementById('avatarBgColor');

  const nicknameInput = document.getElementById('nicknameInput');
  const profileIDText = document.getElementById('profileIDText');
  const copyProfileIDBtn = document.getElementById('copyProfileIDBtn');
  const saveProfileBtn = document.getElementById('saveProfileBtn');
  const profileMessage = document.getElementById('profileMessage');

  const friendsList = document.getElementById('friendsList');
  const addFriendInput = document.getElementById('addFriendInput');
  const addFriendBtn = document.getElementById('addFriendBtn');
  const friendsMessage = document.getElementById('friendsMessage');

  const idNickname = document.getElementById('idNickname');
  const idID = document.getElementById('idID');
  const idAvatar = document.getElementById('idAvatar');

  const apartmentLink = document.getElementById('apartmentLink');
  const generateLinkBtn = document.getElementById('generateLinkBtn');

  const musicSelect = document.getElementById('musicSelect');
  const musicVolume = document.getElementById('musicVolume');
  const musicPlayBtn = document.getElementById('musicPlayBtn');
  const musicPauseBtn = document.getElementById('musicPauseBtn');
  const musicRandomBtn = document.getElementById('musicRandomBtn');

  // –¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å –∏ –¥—Ä—É–∑—å—è
  let profile = {
    nickname: '',
    avatarSymbol: '',
    avatarBg: '#94b66d',
    id: '',
    lastNicknameChange: 0,
    lastAvatarChange: 0,
  };
  let friends = [];

  // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ ID
  function generateID(len = 6) {
    const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let id = '';
    for (let i=0; i<len; i++) {
      id += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return id;
  }

  // –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤ localStorage
  function saveProfile() {
    localStorage.setItem(STORAGE_PROFILE, JSON.stringify(profile));
  }
  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ localStorage
  function loadProfile() {
    const data = localStorage.getItem(STORAGE_PROFILE);
    if (data) {
      try {
        profile = JSON.parse(data);
      } catch {
        profile = {...profile};
      }
    }
    if (!profile.id) profile.id = generateID(7);
  }

  // –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥—Ä—É–∑–µ–π
  function saveFriends() {
    localStorage.setItem(STORAGE_FRIENDS, JSON.stringify(friends));
  }
  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥—Ä—É–∑–µ–π
  function loadFriends() {
    const data = localStorage.getItem(STORAGE_FRIENDS);
    if (data) {
      try {
        friends = JSON.parse(data);
      } catch {
        friends = [];
      }
    }
  }

  // –û–±–Ω–æ–≤–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É –ø—Ä–µ–≤—å—é
  function updateAvatarPreview() {
    avatarPreview.style.backgroundColor = profile.avatarBg;
    avatarPreview.textContent = profile.avatarSymbol || 'üòä';
  }
  // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ
  function updateProfileUI() {
    avatarSymbolInput.value = profile.avatarSymbol || '';
    avatarBgColor.value = profile.avatarBg;
    nicknameInput.value = profile.nickname;
    profileIDText.textContent = profile.id;

    idNickname.textContent = profile.nickname || '(–Ω–µ—Ç –Ω–∏–∫–∞)';
    idID.textContent = profile.id;
    idAvatar.style.backgroundColor = profile.avatarBg;
    idAvatar.textContent = profile.avatarSymbol || 'üòä';
  }

  // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
  function updateFriendsList() {
    friendsList.innerHTML = '';
    if (friends.length === 0) {
      friendsList.innerHTML = '<p>–°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –ø—É—Å—Ç.</p>';
      return;
    }
    friends.forEach(friend => {
      const friendEl = document.createElement('div');
      friendEl.className = 'friendItem';
      friendEl.setAttribute('data-id', friend.id);

      const friendAvatar = document.createElement('div');
      friendAvatar.className = 'friendAvatar';
      friendAvatar.style.backgroundColor = friend.avatarBg || '#94b66d';
      friendAvatar.textContent = friend.avatarSymbol || 'üòä';

      const friendInfo = document.createElement('div');
      friendInfo.className = 'friendInfo';
      friendInfo.textContent = friend.nickname || '(–±–µ–∑ –∏–º–µ–Ω–∏)';

      const buttonsDiv = document.createElement('div');
      buttonsDiv.className = 'friendButtons';

      // –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID
      const copyIDBtn = document.createElement('button');
      copyIDBtn.textContent = 'üìã';
      copyIDBtn.title = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID';
      copyIDBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(friend.id);
        friendsMessage.textContent = `ID –¥—Ä—É–≥–∞ "${friend.nickname}" —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω.`;
        clearMessageLater(friendsMessage);
      });

      // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π
      const delBtn = document.createElement('button');
      delBtn.textContent = '‚ùå';
      delBtn.title = '–£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π';
      delBtn.addEventListener('click', () => {
        if (confirm(`–£–¥–∞–ª–∏—Ç—å "${friend.nickname}" –∏–∑ –¥—Ä—É–∑–µ–π?`)) {
          friends = friends.filter(f => f.id !== friend.id);
          saveFriends();
          updateFriendsList();
          friendsMessage.textContent = `–î—Ä—É–≥ "${friend.nickname}" —É–¥–∞–ª—ë–Ω.`;
          clearMessageLater(friendsMessage);
        }
      });

      buttonsDiv.appendChild(copyIDBtn);
      buttonsDiv.appendChild(delBtn);

      friendEl.appendChild(friendAvatar);
      friendEl.appendChild(friendInfo);
      friendEl.appendChild(buttonsDiv);

      friendsList.appendChild(friendEl);
    });
  }

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
  function clearMessageLater(element, delay = 4000) {
    setTimeout(() => {
      if (element) element.textContent = '';
    }, delay);
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∏–∫–∞ –∏ –∞–≤–∞—Ç–∞—Ä–∫–∏
  function canChangeNickname() {
    const now = Date.now();
    return (now - profile.lastNicknameChange) > (1000 * 60 * 60); // 1 —á–∞—Å
  }
  function canChangeAvatar() {
    const now = Date.now();
    return (now - profile.lastAvatarChange) > (1000 * 60 * 10); // 10 –º–∏–Ω—É—Ç
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
  saveProfileBtn.addEventListener('click', () => {
    const newNickname = nicknameInput.value.trim();
    const newAvatarSymbol = avatarSymbolInput.value.trim().toUpperCase();
    const newAvatarBg = avatarBgColor.value;

    // –ü—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
    if (newNickname.length === 0) {
      profileMessage.textContent = '–ù–∏–∫–Ω–µ–π–º –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.';
      return;
    }
    if (newNickname.length > 25) {
      profileMessage.textContent = '–ù–∏–∫–Ω–µ–π–º —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π.';
      return;
    }
    if (newAvatarSymbol.length > 2) {
      profileMessage.textContent = '–ê–≤–∞—Ç–∞—Ä–∫–∞: –º–∞–∫—Å–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞.';
      return;
    }
    if (newNickname !== profile.nickname && !canChangeNickname()) {
      profileMessage.textContent = '–ù–∏–∫ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–µ —á–∞—â–µ —Ä–∞–∑–∞ –≤ —á–∞—Å.';
      return;
    }
    if ((newAvatarSymbol !== profile.avatarSymbol || newAvatarBg !== profile.avatarBg) && !canChangeAvatar()) {
      profileMessage.textContent = '–ê–≤–∞—Ç–∞—Ä–∫—É –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–µ —á–∞—â–µ —á–µ–º —Ä–∞–∑ –≤ 10 –º–∏–Ω—É—Ç.';
      return;
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
    if (newNickname !== profile.nickname) {
      profile.nickname = newNickname;
      profile.lastNicknameChange = Date.now();
    }
    if (newAvatarSymbol !== profile.avatarSymbol || newAvatarBg !== profile.avatarBg) {
      profile.avatarSymbol = newAvatarSymbol || 'üòä';
      profile.avatarBg = newAvatarBg;
      profile.lastAvatarChange = Date.now();
    }
    saveProfile();
    updateProfileUI();
    profileMessage.textContent = '–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω.';
    clearMessageLater(profileMessage);
  });

  // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–µ–≤—å—é
  avatarSymbolInput.addEventListener('input', () => {
    profile.avatarSymbol = avatarSymbolInput.value.trim().toUpperCase() || 'üòä';
    updateAvatarPreview();
  });
  avatarBgColor.addEventListener('input', () => {
    profile.avatarBg = avatarBgColor.value;
    updateAvatarPreview();
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è ID
  copyProfileIDBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(profile.id);
    profileMessage.textContent = 'ID –ø—Ä–æ—Ñ–∏–ª—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω.';
    clearMessageLater(profileMessage);
  });

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ç–∞–±–∞–º
  function setActiveTab(tab) {
    tabProfileBtn.setAttribute('aria-selected', 'false');
    tabProfileBtn.tabIndex = -1;
    tabFriendsBtn.setAttribute('aria-selected', 'false');
    tabFriendsBtn.tabIndex = -1;
    tabIDBtn.setAttribute('aria-selected', 'false');
    tabIDBtn.tabIndex = -1;

    profileSection.classList.remove('active');
    friendsSection.classList.remove('active');
    idSection.classList.remove('active');

    if (tab === 'profile') {
      tabProfileBtn.setAttribute('aria-selected', 'true');
      tabProfileBtn.tabIndex = 0;
      profileSection.classList.add('active');
      profileSection.focus();
    } else if (tab === 'friends') {
      tabFriendsBtn.setAttribute('aria-selected', 'true');
      tabFriendsBtn.tabIndex = 0;
      friendsSection.classList.add('active');
      friendsSection.focus();
    } else if (tab === 'id') {
      tabIDBtn.setAttribute('aria-selected', 'true');
      tabIDBtn.tabIndex = 0;
      idSection.classList.add('active');
      idSection.focus();
    }
  }
  tabProfileBtn.addEventListener('click', () => setActiveTab('profile'));
  tabFriendsBtn.addEventListener('click', () => setActiveTab('friends'));
  tabIDBtn.addEventListener('click', () => setActiveTab('id'));

  // –û—Ç–∫—Ä—ã—Ç—å / –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
  function openProfile() {
    profileOverlay.style.display = 'flex';
    profileOverlay.setAttribute('aria-hidden', 'false');
    updateProfileUI();
    updateFriendsList();
    setActiveTab('profile');
  }
  function closeProfile() {
    profileOverlay.style.display = 'none';
    profileOverlay.setAttribute('aria-hidden', 'true');
  }
  profileCloseBtn.addEventListener('click', closeProfile);

  
