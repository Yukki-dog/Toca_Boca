<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–¢–≤–æ—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ + –î—Ä—É–∑—å—è</title>
<style>
  /* --- –û–ë–©–ò–ï –°–¢–ò–õ–ò --- */
  body {
    margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f0f0f5;
    user-select: none;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    background: #6c5ce7;
    color: white;
    padding: 12px 20px;
    font-size: 1.4rem;
    font-weight: 600;
    text-align: center;
    box-shadow: 0 3px 7px rgba(0,0,0,0.15);
  }
  main {
    flex: 1;
    display: flex;
    gap: 15px;
    padding: 15px;
  }
  button {
    cursor: pointer;
    background: #6c5ce7;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: 600;
    padding: 8px 14px;
    user-select: none;
    transition: background 0.25s;
  }
  button:hover {
    background: #4834d4;
  }
  input, select {
    font-size: 1rem;
    padding: 6px 10px;
    border-radius: 6px;
    border: 1.5px solid #ccc;
    outline-offset: 2px;
    outline-color: #6c5ce7;
    transition: border-color 0.3s;
  }
  input:focus, select:focus {
    border-color: #6c5ce7;
  }
  .section {
    background: white;
    border-radius: 12px;
    box-shadow: 0 0 15px #bbb;
    padding: 12px 15px;
    flex-shrink: 0;
  }

  /* --- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ ‚Äî –ö–û–ú–ù–ê–¢–´ –ò –ú–ï–ë–ï–õ–¨ --- */
  #room-panel {
    flex: 1.4;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  #room-name {
    font-weight: 700;
    font-size: 1.3rem;
    margin-bottom: 6px;
    text-align: center;
  }
  #room-container {
    flex: 1;
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    border: 3px solid #6c5ce7;
    background: white;
    box-shadow: inset 0 0 15px #a29bfe;
  }
  #room-canvas {
    width: 100%;
    height: 400px;
    background: transparent;
    user-select: none;
  }
  .nav-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 6px;
  }
  .nav-buttons button {
    width: 48%;
  }

  /* --- –ü–ê–ù–ï–õ–¨ –ù–ê–°–¢–†–û–ï–ö –ö–û–ú–ù–ê–¢–´ --- */
  #settings-panel {
    flex: 0.7;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  #wallpaper-selector, #floor-selector {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  #wallpaper-selector label, #floor-selector label {
    font-weight: 600;
  }
  .pattern-preview {
    font-family: monospace;
    font-size: 1.6rem;
    user-select: none;
    border: 1px solid #aaa;
    padding: 6px;
    border-radius: 6px;
    background: #fafafa;
    text-align: center;
  }
  .color-picker {
    width: 100%;
    height: 30px;
    border: none;
    cursor: pointer;
  }

  /* --- –ü–ê–ù–ï–õ–¨ –ú–ï–ë–ï–õ–ò --- */
  #furniture-panel {
    flex: 1;
    background: white;
    border-radius: 12px;
    box-shadow: 0 0 15px #bbb;
    padding: 10px;
    display: flex;
    flex-direction: column;
  }
  #furniture-list {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    overflow-y: auto;
    max-height: 350px;
  }
  .furniture-item {
    user-select: none;
    cursor: grab;
    background: #dfe6e9;
    border-radius: 12px;
    padding: 8px 10px;
    box-shadow: 0 2px 6px #b2bec3;
    text-align: center;
    min-width: 70px;
    font-weight: 700;
    font-size: 1rem;
    transition: box-shadow 0.3s;
  }
  .furniture-item:hover {
    box-shadow: 0 5px 14px #6c5ce7;
  }

  /* --- –ü–û–õ–ï –î–õ–Ø –ò–ì–†–û–í–û–ô –ö–û–ú–ù–ê–¢–´ --- */
  #play-area {
    position: relative;
    flex: 3;
    background: #fefefe;
    border-radius: 14px;
    box-shadow: 0 0 25px #6c5ce7aa;
    overflow: hidden;
  }
  #room-floor {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 100px;
    user-select: none;
  }
  #room-wall {
    position: absolute;
    top: 0;
    width: 100%;
    height: calc(100% - 100px);
    user-select: none;
  }

  /* --- –ú–ï–ë–ï–õ–¨ –í –ö–û–ú–ù–ê–¢–ï --- */
  .placed-furniture {
    position: absolute;
    cursor: grab;
    user-select: none;
    border-radius: 8px;
    box-shadow: 0 2px 6px #8888;
    transition: transform 0.25s ease;
  }
  .placed-furniture.dragging {
    opacity: 0.7;
    cursor: grabbing;
    z-index: 9999;
  }

  /* --- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ ‚Äî –ü–†–û–§–ò–õ–¨ –ò –î–†–£–ó–¨–Ø --- */
  #profile-friends-panel {
    flex: 1.2;
    background: white;
    border-radius: 12px;
    box-shadow: 0 0 20px #bbb;
    padding: 12px 15px;
    display: flex;
    flex-direction: column;
  }
  #profile-section {
    margin-bottom: 15px;
  }
  #profile-section h3 {
    margin: 0 0 6px 0;
    font-weight: 700;
    font-size: 1.3rem;
  }
  #profile-form {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  #profile-form label {
    font-weight: 600;
  }
  #profile-form input[type="text"], #profile-form input[type="color"] {
    padding: 6px 8px;
    border-radius: 6px;
    border: 1.5px solid #ccc;
    outline-color: #6c5ce7;
  }
  #profile-form input[type="color"] {
    height: 32px;
  }
  #profile-id {
    font-family: monospace;
    background: #eee;
    padding: 6px 8px;
    border-radius: 6px;
    user-select: all;
  }

  /* --- –î–†–£–ó–¨–Ø --- */
  #friends-section h3 {
    margin: 0 0 6px 0;
    font-weight: 700;
    font-size: 1.3rem;
  }
  #friends-list {
    flex: 1;
    overflow-y: auto;
  }
  .friend-card {
    display: flex;
    align-items: center;
    padding: 6px 10px;
    margin-bottom: 8px;
    border-radius: 10px;
    background: #f5f6fa;
    box-shadow: 0 1px 4px #bbb;
    gap: 10px;
  }
  .friend-avatar {
    font-size: 1.9rem;
    user-select: none;
    min-width: 36px;
    text-align: center;
  }
  .friend-info {
    flex: 1;
    user-select: none;
  }
  .friend-nick {
    font-weight: 700;
    font-size: 1.1rem;
  }
  .friend-id {
    font-family: monospace;
    font-size: 0.8rem;
    color: #555;
    user-select: all;
  }
  .friend-buttons {
    display: flex;
    gap: 6px;
  }
  .friend-buttons button {
    padding: 5px 8px;
    font-size: 0.8rem;
    background: #6c5ce7;
    border-radius: 8px;
    color: white;
  }
  .friend-buttons button:hover {
    background: #4834d4;
  }

  /* --- –ú–û–î–ê–õ --- */
  #modal-overlay {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.38);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }
  #modal {
    background: white;
    padding: 18px 25px;
    border-radius: 14px;
    width: 320px;
    max-width: 95vw;
    box-shadow: 0 0 35px #6c5ce7aa;
  }
  #modal h3 {
    margin-top: 0;
    font-weight: 700;
    margin-bottom: 12px;
    text-align: center;
  }
  #modal textarea {
    width: 100%;
    height: 90px;
    border-radius: 8px;
    border: 1.5px solid #ccc;
    padding: 10px;
    resize: none;
    font-family: monospace;
    font-size: 0.9rem;
  }
  #modal-buttons {
    margin-top: 10px;
    display: flex;
    justify-content: space-between;
  }
  #modal-buttons button {
    flex: 1;
    margin: 0 4px;
  }
</style>
</head>
<body>

<header>–¢–≤–æ—è –ö–≤–∞—Ä—Ç–∏—Ä–∞ —Å –î—Ä—É–∑—å—è–º–∏ &amp; –ú–µ–±–µ–ª—å—é</header>

<main>

<!-- –õ–µ–≤—ã–π –±–ª–æ–∫: –∫–æ–º–Ω–∞—Ç—ã –∏ –º–µ–±–µ–ª—å -->
<div id="room-panel" class="section">
  <div id="room-name">–ö–æ–º–Ω–∞—Ç–∞ 1</div>
  <div id="room-container">
    <canvas id="room-wall"></canvas>
    <canvas id="room-floor"></canvas>
    <div id="play-area" style="position:absolute;top:0;left:0;right:0;bottom:0;"></div>
  </div>
  <div class="nav-buttons">
    <button id="prev-room-btn">&larr; –ü—Ä–µ–¥—ã–¥—É—â–∞—è –∫–æ–º–Ω–∞—Ç–∞</button>
    <button id="next-room-btn">–°–ª–µ–¥—É—é—â–∞—è –∫–æ–º–Ω–∞—Ç–∞ &rarr;</button>
  </div>

  <div id="wallpaper-selector">
    <label for="wallpaper-pattern">–û–±–æ–∏ (—É–∑–æ—Ä—ã):</label>
    <select id="wallpaper-pattern"></select>
    <label for="wallpaper-color">–¶–≤–µ—Ç –æ–±–æ–µ–≤:</label>
    <input type="color" id="wallpaper-color" value="#c8f7dc" />
  </div>

  <div id="floor-selector">
    <label for="floor-pattern">–ü–æ–ª (—É–∑–æ—Ä—ã):</label>
    <select id="floor-pattern"></select>
    <label for="floor-color">–¶–≤–µ—Ç –ø–æ–ª–∞:</label>
    <input type="color" id="floor-color" value="#a3d2ca" />
  </div>
</div>

<!-- –ü–∞–Ω–µ–ª—å –º–µ–±–µ–ª–∏ -->
<div id="furniture-panel" class="section">
  <h3>–ú–µ–±–µ–ª—å (–ø–µ—Ä–µ—Ç–∞—â–∏ –≤ –∫–æ–º–Ω–∞—Ç—É)</h3>
  <div id="furniture-list"></div>
</div>

<!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –ø—Ä–æ—Ñ–∏–ª—å –∏ –¥—Ä—É–∑—å—è -->
<div id="profile-friends-panel" class="section">
  <div id="profile-section">
    <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
    <form id="profile-form">
      <label for="profile-nick">–ù–∏–∫:</label>
      <input type="text" id="profile-nick" maxlength="20" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫" required />
      <label for="profile-avatar">–ê–≤–∞—Ç–∞—Ä (—Å–º–∞–π–ª –∏–ª–∏ —Å–∏–º–≤–æ–ª):</label>
      <input type="text" id="profile-avatar" maxlength="2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: üê∂ –∏–ª–∏ A" required />
      <label for="profile-bgcolor">–§–æ–Ω –ø—Ä–æ—Ñ–∏–ª—è:</label>
      <input type="color" id="profile-bgcolor" value="#a29bfe" />
      <label>ID (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è —Ç–µ–±—è):</label>
      <div id="profile-id" title="–≠—Ç–æ —Ç–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID."></div>
      <button type="submit" style="margin-top:10px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
    </form>
  </div>

  <div id="friends-section">
    <h3>–î—Ä—É–∑—å—è</h3>
    <button id="add-friend-btn" style="margin-bottom:10px;">–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</button>
    <div id="friends-list"></div>
  </div>

  <div style="margin-top:15px; text-align:center;">
    <button id="copy-room-code-btn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã</button>
    <button id="paste-room-code-btn">–í—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã -->
<div id="modal-overlay">
  <div id="modal">
    <h3>–í—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥—Ä—É–≥–∞</h3>
    <textarea id="room-code-input" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –∫–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥—Ä—É–≥–∞..."></textarea>
    <div id="modal-buttons">
      <button id="modal-cancel-btn">–û—Ç–º–µ–Ω–∞</button>
      <button id="modal-ok-btn">–í—Å—Ç–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>

<script>
(() => {
  // --- –£–ó–û–†–´ ---
  const wallpaperPatterns = {
    '‚ñ†‚óç‚óØ‚à™‚ñ°ÍôÆ‚Äª‚Üà√ó': "‚ñ†‚óç‚óØ‚à™‚ñ°ÍôÆ‚Äª‚Üà√ó",
    '–ö—Ä—É–∂–æ—á–∫–∏': '‚óØ‚óØ‚óØ‚óØ‚óØ‚óØ‚óØ‚óØ',
    '–ü–æ–ª–æ—Å–∫–∏': '||||||||||||||||||||',
    '–ö–≤–∞–¥—Ä–∞—Ç—ã': '‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†',
    '–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏': '‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤',
    '–ó–≤—ë–∑–¥–æ—á–∫–∏': '‚Äª‚Äª‚Äª‚Äª‚Äª‚Äª‚Äª‚Äª‚Äª‚Äª‚Äª‚Äª',
    '–®—Ç—Ä–∏—Ö–æ–≤–∫–∞': '////////////////////',
    '–ö—Ä–µ—Å—Ç–∏–∫–∏': '√ó√ó√ó√ó√ó√ó√ó√ó√ó√ó√ó√ó√ó√ó√ó√ó',
    '–ó–∏–≥–∑–∞–≥–∏': '‚óú‚óù‚óû‚óü‚óú‚óù‚óû‚óü',
    '–ü—É—Å—Ç–æ': ''
  };
  const floorPatterns = {
    '–ü–æ–ª–æ—Å–∫–∏': '||||||||||||||||||||',
    '–ö–∞–º–µ–Ω—å': '‚®∑‚®∑‚®∑‚®∑  ‚®∑  ‚®∑‚®∑ ‚®∑',
    '–ü–ª–∏—Ç–∫–∞': '‚ñ¢‚ñ¢ ‚ñ¢‚ñ¢‚ñ¢ ‚ñ¢‚ñ¢ ‚ñ¢‚ñ¢‚ñ¢',
    '–ö–≤–∞–¥—Ä–∞—Ç—ã': '‚ñ†‚ñ†‚ñ†‚ñ† ‚ñ†‚ñ†‚ñ†‚ñ† ‚ñ†‚ñ†‚ñ†‚ñ† ‚ñ†‚ñ†‚ñ†‚ñ†',
    '–ó–∏–≥–∑–∞–≥–∏': '‚óú‚óù‚óû‚óü‚óú‚óù‚óû‚óü',
    '–ü—É—Å—Ç–æ': ''
  };

  // --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---

  let currentRoomIndex = 0;
  let totalRooms = 3;
  let rooms = [];

  // –ú–µ–±–µ–ª—å - —Å–æ–∑–¥–∞–¥–∏–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (100+ —É—Å–ª–æ–≤–Ω–æ, –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –ø–æ—Å—Ç–∞–≤–∏–º –º–µ–Ω—å—à–µ, –Ω–æ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å)
  const furnitureItems = [
    {id: 'sofa', name: '–î–∏–≤–∞–Ω', width: 120, height: 60, color: '#fd79a8', shape: 'rounded'},
    {id: 'armchair', name: '–ö—Ä–µ—Å–ª–æ', width: 60, height: 60, color: '#fab1a0', shape: 'rounded'},
    {id: 'chair', name: '–°—Ç—É–ª', width: 40, height: 40, color: '#74b9ff', shape: 'square'},
    {id: 'table', name: '–°—Ç–æ–ª', width: 80, height: 50, color: '#ffeaa7', shape: 'square'},
    {id: 'lamp', name: '–õ–∞–º–ø–∞', width: 30, height: 80, color: '#fdcb6e', shape: 'rounded'},
    {id: 'bookshelf', name: '–ö–Ω–∏–∂–Ω—ã–π —à–∫–∞—Ñ', width: 50, height: 100, color: '#dfe6e9', shape: 'square'},
    {id: 'plant', name: '–†–∞—Å—Ç–µ–Ω–∏–µ', width: 40, height: 60, color: '#55efc4', shape: 'rounded'},
    {id: 'rug', name: '–ö–æ–≤–µ—Ä', width: 120, height: 80, color: '#a29bfe', shape: 'rounded'},
    // –î–æ–±–∞–≤–∏–º –µ—â–µ –ø–æ 10 –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞, –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–∞–ª—å—à–µ
    {id: 'pillow', name: '–ü–æ–¥—É—à–∫–∞', width: 40, height: 25, color: '#ff7675', shape: 'rounded'},
    {id: 'clock', name: '–ß–∞—Å—ã', width: 30, height: 30, color: '#fd79a8', shape: 'rounded'},
    {id: 'mirror', name: '–ó–µ—Ä–∫–∞–ª–æ', width: 40, height: 60, color: '#dfe6e9', shape: 'rounded'},
    {id: 'dresser', name: '–ö–æ–º–æ–¥', width: 80, height: 70, color: '#ffeaa7', shape: 'square'},
    {id: 'tv', name: '–¢–µ–ª–µ–≤–∏–∑–æ—Ä', width: 100, height: 60, color: '#636e72', shape: 'square'},
    {id: 'sofa_small', name: '–ú–∞–ª—ã–π –¥–∏–≤–∞–Ω', width: 80, height: 50, color: '#fab1a0', shape: 'rounded'},
    {id: 'desk', name: '–ü–∏—Å—å–º–µ–Ω–Ω—ã–π —Å—Ç–æ–ª', width: 90, height: 50, color: '#ffeaa7', shape: 'square'}
  ];

  // –î—Ä—É–∑—å—è
  let friends = [];

  // –ü—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  let userProfile = {
    nick: '',
    avatar: '',
    bgColor: '#a29bfe',
    id: ''
  };

 // –°–Ω–∞—á–∞–ª–∞ –æ–±—ä—è–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ (–≤–Ω–µ —Ü–∏–∫–ª–∞ –∫–æ–º–Ω–∞—Ç)
const wallPatterns = [
  '‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†‚ñ†',           // –ø–ª–æ—Ç–Ω—ã–µ –∫–≤–∞–¥—Ä–∞—Ç—ã
  '‚óç ‚óç ‚óç ‚óç',           // –∫—Ä—É–∂–æ—á–∫–∏ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
  'ÍôÆ  ÍôÆ  ÍôÆ',           // –Ω–µ–æ–±—ã—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, —Ä–µ–¥–∫–æ
  '‚Üà‚Üà‚Üà‚Üà‚Üà',             // –ø–ª–æ—Ç–Ω—ã–µ —É–∑–æ—Ä—ã
  '‚Äª ‚Äª ‚Äª ‚Äª',         // –∑–≤–µ–∑–¥–æ—á–∫–∏
  '‚óØ\n‚óØ\n‚óØ',           // –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ
  '‚à™ ‚à™ ‚à™ ‚à™',          // –ø–æ–ª—É–∫—Ä—É–≥–∏
];

const floorPatterns = [
  '||||||||||||',     // –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π –ø–æ–ª
  '‚®∑   ‚®∑   ‚®∑',        // —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω—ã–µ –∫–∞–º–µ—à–∫–∏
  ':::::::',           // –∫–æ–≤—Ä–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
  '‚ß´ ‚ß´ ‚ß´ ‚ß´',         // –ø–ª–∏—Ç–∫–∞
  '‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë',           // –º—è–≥–∫–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
  '‚âà‚âà‚âà‚âà‚âà‚âà‚âà',           // –≤–æ–ª–Ω—ã
];

// –°–æ–∑–¥–∞—ë–º –∫–æ–º–Ω–∞—Ç—ã —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏
for(let i=0; i<totalRooms; i++) {
  rooms.push({
    wallpaperPattern: wallPatterns[0],  // –ø–µ—Ä–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —Å—Ç–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    wallpaperColor: '#c8f7dc',           // —Ü–≤–µ—Ç —Å—Ç–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    floorPattern: floorPatterns[0],      // –ø–µ—Ä–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –ø–æ–ª–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    floorColor: '#a3d2ca',               // —Ü–≤–µ—Ç –ø–æ–ª–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    furniture: [],                       // –ø—É—Å—Ç–∞—è –º–µ–±–µ–ª—å
  });
}

  // --- –≠–õ–ï–ú–ï–ù–¢–´ DOM ---
  const wallpaperSelect = document.getElementById('wallpaper-pattern');
  const wallpaperColorInput = document.getElementById('wallpaper-color');
  const floorSelect = document.getElementById('floor-pattern');
  const floorColorInput = document.getElementById('floor-color');
  const furnitureListDiv = document.getElementById('furniture-list');
  const playArea = document.getElementById('play-area');
  const roomNameDiv = document.getElementById('room-name');
  const prevRoomBtn = document.getElementById('prev-room-btn');
  const nextRoomBtn = document.getElementById('next-room-btn');

  // –ü—Ä–æ—Ñ–∏–ª—å
  const profileNickInput = document.getElementById('profile-nick');
  const profileAvatarInput = document.getElementById('profile-avatar');
  const profileBgColorInput = document.getElementById('profile-bgcolor');
  const profileIdDiv = document.getElementById('profile-id');
  const profileForm = document.getElementById('profile-form');

  // –î—Ä—É–∑—å—è
  const friendsListDiv = document.getElementById('friends-list');
  const addFriendBtn = document.getElementById('add-friend-btn');

  // –ö–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è/–≤—Å—Ç–∞–≤–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä—ã
  const copyRoomCodeBtn = document.getElementById('copy-room-code-btn');
  const pasteRoomCodeBtn = document.getElementById('paste-room-code-btn');

  // –ú–æ–¥–∞–ª –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞
  const modalOverlay = document.getElementById('modal-overlay');
  const modalCancelBtn = document.getElementById('modal-cancel-btn');
  const modalOkBtn = document.getElementById('modal-ok-btn');
  const roomCodeInput = document.getElementById('room-code-input');

  // –ö–∞–Ω–≤–∞—Å—ã —Å—Ç–µ–Ω –∏ –ø–æ–ª–∞
  const roomWallCanvas = document.getElementById('room-wall');
  const roomFloorCanvas = document.getElementById('room-floor');
  const wallCtx = roomWallCanvas.getContext('2d');
  const floorCtx = roomFloorCanvas.getContext('2d');

  // –†–∞–∑–º–µ—Ä—ã –∫–∞–Ω–≤–∞—Å–∞
  function resizeCanvas() {
    roomWallCanvas.width = roomWallCanvas.clientWidth;
    roomWallCanvas.height = roomWallCanvas.clientHeight;
    roomFloorCanvas.width = roomFloorCanvas.clientWidth;
    roomFloorCanvas.height = roomFloorCanvas.clientHeight;
    drawRoom();
  }
  window.addEventListener('resize', resizeCanvas);

  // --- –§–£–ù–ö–¶–ò–ò ---

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID
  function generateId(len=8){
    const chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
    let res = '';
    for(let i=0; i<len; i++) {
      res += chars.charAt(Math.floor(Math.random()*chars.length));
    }
    return res;
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –∏–∑ localStorage
  function loadUserProfile() {
    const saved = localStorage.getItem('userProfile');
    if(saved) {
      userProfile = JSON.parse(saved);
    } else {
      userProfile.id = generateId(10);
      userProfile.nick = '–ò–≥—Ä–æ–∫' + Math.floor(Math.random()*1000);
      userProfile.avatar = 'üòÄ';
      userProfile.bgColor = '#a29bfe';
      saveUserProfile();
    }
    profileNickInput.value = userProfile.nick;
    profileAvatarInput.value = userProfile.avatar;
    profileBgColorInput.value = userProfile.bgColor;
    profileIdDiv.textContent = userProfile.id;
  }
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
  function saveUserProfile() {
    localStorage.setItem('userProfile', JSON.stringify(userProfile));
  }

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–º–Ω–∞—Ç—ã
  function drawRoom() {
    const room = rooms[currentRoomIndex];
    if(!room) return;

    // –°—Ç–µ–Ω–∞
    drawPattern(wallCtx, room.wallpaperPattern, room.wallpaperColor, roomWallCanvas.width, roomWallCanvas.height);

    // –ü–æ–ª
    drawPattern(floorCtx, room.floorPattern, room.floorColor, roomFloorCanvas.width, roomFloorCanvas.height);

    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –º–µ–±–µ–ª—å
    while(playArea.firstChild) playArea.removeChild(playArea.firstChild);

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–±–µ–ª—å
    room.furniture.forEach(item => {
      const f = furnitureItems.find(fi => fi.id === item.id);
      if(!f) return;
      const div = document.createElement('div');
      div.className = 'placed-furniture';
      div.style.width = f.width + 'px';
      div.style.height = f.height + 'px';
      div.style.left = item.x + 'px';
      div.style.top = item.y + 'px';
      div.style.backgroundColor = f.color;
      div.style.borderRadius = f.shape === 'rounded' ? '15px' : '3px';
      div.title = f.name;
      div.draggable = true;
      playArea.appendChild(div);

      // Drag and drop –¥–ª—è –º–µ–±–µ–ª–∏
      div.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', item.id);
        e.dataTransfer.setData('offsetX', e.offsetX);
        e.dataTransfer.setData('offsetY', e.offsetY);
        div.classList.add('dragging');
      });
      div.addEventListener('dragend', (e) => {
        div.classList.remove('dragging');
      });
    });
  }

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —É–∑–æ—Ä–∞ –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ
  function drawPattern(ctx, patternStr, color, w, h) {
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle = color;
    ctx.font = '24px monospace';
    ctx.textBaseline = 'top';
    if(!patternStr) return;

    // –ü–æ–∫—Ä–æ–µ–º –∫–∞–Ω–≤–∞—Å —É–∑–æ—Ä–∞–º–∏, –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è —Å—Ç—Ä–æ–∫–∞–º–∏
    const stepX = 26;
    const stepY = 26;
    for(let y=0; y<h; y+=stepY) {
      for(let x=0; x<w; x+=stepX) {
        const ch = patternStr.charAt((Math.floor(x/stepX) + Math.floor(y/stepY)) % patternStr.length);
        ctx.fillText(ch, x, y);
      }
    }
  }

  // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –æ–±–æ–µ–≤ –∏ –ø–æ–ª–∞
  function fillSelectors() {
    wallpaperSelect.innerHTML = '';
    Object.keys(wallpaperPatterns).forEach(p => {
      const opt = document.createElement('option');
      opt.value = p;
      opt.textContent = p;
      wallpaperSelect.appendChild(opt);
    });

    floorSelect.innerHTML = '';
    Object.keys(floorPatterns).forEach(p => {
      const opt = document.createElement('option');
      opt.value = p;
      opt.textContent = p;
      floorSelect.appendChild(opt);
    });
  }

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–Ω–∞—Ç—É
  function saveRoomSettings() {
    const room = rooms[currentRoomIndex];
    room.wallpaperPattern = wallpaperSelect.value;
    room.wallpaperColor = wallpaperColorInput.value;
    room.floorPattern = floorSelect.value;
    room.floorColor = floorColorInput.value;
    saveRooms();
    drawRoom();
  }

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–º–Ω–∞—Ç—ã –≤ localStorage
  function saveRooms() {
    localStorage.setItem('rooms', JSON.stringify(rooms));
  }
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–Ω–∞—Ç—ã –∏–∑ localStorage
  function loadRooms() {
    const saved = localStorage.getItem('rooms');
    if(saved) {
      const parsed = JSON.parse(saved);
      if(Array.isArray(parsed) && parsed.length >= totalRooms) {
        rooms = parsed;
      }
    }
  }

  // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Ç–µ–∫—É—â–µ–π –∫–æ–º–Ω–∞—Ç–æ–π
  function updateRoomUI() {
    roomNameDiv.textContent = `–ö–æ–º–Ω–∞—Ç–∞ ${currentRoomIndex + 1}`;
    const room = rooms[currentRoomIndex];
    wallpaperSelect.value = room.wallpaperPattern;
    wallpaperColorInput.value = room.wallpaperColor;
    floorSelect.value = room.floorPattern;
    floorColorInput.value = room.floorColor;
    drawRoom();
  }

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –∫–æ–º–Ω–∞—Ç–∞–º–∏
  prevRoomBtn.onclick = () => {
    if(currentRoomIndex > 0) {
      currentRoomIndex--;
      updateRoomUI();
    }
  };
  nextRoomBtn.onclick = () => {
    if(currentRoomIndex < totalRooms-1) {
      currentRoomIndex++;
      updateRoomUI();
    }
  };

  // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –º–µ–±–µ–ª–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤ –∫–æ–º–Ω–∞—Ç—É
  function createFurnitureItemsUI() {
    furnitureListDiv.innerHTML = '';
    furnitureItems.forEach(f => {
      const div = document.createElement('div');
      div.className = 'furniture-item';
      div.textContent = f.name;
      div.draggable = true;
      div.style.backgroundColor = f.color;
      div.style.borderRadius = f.shape === 'rounded' ? '12px' : '3px';
      furnitureListDiv.appendChild(div);

      div.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/furniture-id', f.id);
      });
    });
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ drop –Ω–∞ –∏–≥—Ä–æ–≤—É—é –æ–±–ª–∞—Å—Ç—å (–∫–æ–º–Ω–∞—Ç—É)
  playArea.addEventListener('dragover', (e) => {
    e.preventDefault();
  });
  playArea.addEventListener('drop', (e) => {
    e.preventDefault();
    const furnitureId = e.dataTransfer.getData('text/furniture-id');
    if(furnitureId) {
      const rect = playArea.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      // –î–æ–±–∞–≤–ª—è–µ–º –º–µ–±–µ–ª—å –≤ –∫–æ–º–Ω–∞—Ç—É
      const room = rooms[currentRoomIndex];
      room.furniture.push({id: furnitureId, x: x - 30, y: y - 30});
      saveRooms();
      drawRoom();
    }
  });

  // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –º–µ–±–µ–ª–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–Ω–∞—Ç—ã (drag furniture)
  let draggedFurniture = null;
  let dragOffsetX = 0;
  let dragOffsetY = 0;

  playArea.addEventListener('mousedown', (e) => {
    if(!e.target.classList.contains('placed-furniture')) return;
    draggedFurniture = e.target;
    dragOffsetX = e.offsetX;
    dragOffsetY = e.offsetY;
    draggedFurniture.classList.add('dragging');
  });
  window.addEventListener('mousemove', (e) => {
    if(!draggedFurniture) return;
    const rect = playArea.getBoundingClientRect();
    let x = e.clientX - rect.left - dragOffsetX;
    let y = e.clientY - rect.top - dragOffsetY;
    if(x<0) x=0;
    if(y<0) y=0;
    if(x+draggedFurniture.offsetWidth > rect.width) x = rect.width - draggedFurniture.offsetWidth;
    if(y+draggedFurniture.offsetHeight > rect.height) y = rect.height - draggedFurniture.offsetHeight;
    draggedFurniture.style.left = x + 'px';
    draggedFurniture.style.top = y + 'px';
  });
  window.addEventListener('mouseup', (e) => {
    if(draggedFurniture) {
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–µ–±–µ–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç–∞—Ö[]
      const furnitureDiv = draggedFurniture;
      const left = parseInt(furnitureDiv.style.left);
      const top = parseInt(furnitureDiv.style.top);
      const idx = rooms[currentRoomIndex].furniture.findIndex(fur => {
        // –°—Ä–∞–≤–Ω–∏–º –ø–æ–∑–∏—Ü–∏—é —Å div –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É (name) –∏ —Ä–∞–∑–º–µ—Ä—É
        return furnitureDiv.title === furnitureItems.find(fi=>fi.id===fur.id)?.name &&
          Math.abs(fur.x - left) < 50 && Math.abs(fur.y - top) < 50;
      });
      if(idx >= 0) {
        rooms[currentRoomIndex].furniture[idx].x = left;
        rooms[currentRoomIndex].furniture[idx].y = top;
        saveRooms();
      }
      draggedFurniture.classList.remove('dragging');
      draggedFurniture = null;
    }
  });

  // --- –ü–†–û–§–ò–õ–¨ ---
  profileForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const nick = profileNickInput.value.trim();
    const avatar = profileAvatarInput.value.trim();
    const bgColor = profileBgColorInput.value;
    if(nick && avatar) {
      userProfile.nick = nick;
      userProfile.avatar = avatar;
      userProfile.bgColor = bgColor;
      saveUserProfile();
      renderFriends(); // —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    }
  });

  // --- –î–†–£–ó–¨–Ø ---
  function loadFriends() {
    const saved = localStorage.getItem('friends');
    if(saved) {
      friends = JSON.parse(saved);
    }
  }
  function saveFriends() {
    localStorage.setItem('friends', JSON.stringify(friends));
  }
  // –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞ —á–µ—Ä–µ–∑ prompt
  addFriendBtn.onclick = () => {
    const input = prompt('–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:');
    if(input && input.trim() !== userProfile.id) {
      if(!friends.find(f => f.id === input.trim())) {
        // –î–æ–±–∞–≤–ª—è–µ–º –¥—Ä—É–≥–∞ —Å –ø—É—Å—Ç—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, —á—Ç–æ–±—ã –ø–æ–∑–∂–µ –æ–±–Ω–æ–≤–∏—Ç—å
        friends.push({id: input.trim(), nick: '', avatar: '', bgColor: '#dfe6e9', lastRoomData: null});
        saveFriends();
        renderFriends();
      } else alert('–≠—Ç–æ—Ç –¥—Ä—É–≥ —É–∂–µ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ');
    } else if(input.trim() === userProfile.id) {
      alert('–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è');
    }
  };

  // –£–¥–∞–ª–∏—Ç—å –¥—Ä—É–≥–∞
  function removeFriend(id) {
    friends = friends.filter(f => f.id !== id);
    saveFriends();
    renderFriends();
  }

  // –û–±–Ω–æ–≤–∏—Ç—å –¥—Ä—É–≥–∞ (–Ω–∏–∫, –∞–≤–∞—Ç–∞—Ä, —Ñ–æ–Ω –∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞)
  function updateFriendData(id, nick, avatar, bgColor, roomData) {
    const fr = friends.find(f => f.id === id);
    if(fr) {
      fr.nick = nick;
      fr.avatar = avatar;
      fr.bgColor = bgColor;
      fr.lastRoomData = roomData;
      saveFriends();
      renderFriends();
    }
  }

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π —Å –∫–Ω–æ–ø–∫–∞–º–∏
  function renderFriends() {
    friendsListDiv.innerHTML = '';
    friends.forEach(friend => {
      const card = document.createElement('div');
      card.className = 'friend-card';

      const ava = document.createElement('div');
      ava.className = 'friend-avatar';
      ava.textContent = friend.avatar || 'üôÇ';
      ava.style.backgroundColor = friend.bgColor || '#dfe6e9';

      const info = document.createElement('div');
      info.className = 'friend-info';

      const nick = document.createElement('div');
      nick.className = 'friend-nick';
      nick.textContent = friend.nick || '–ë–µ–∑ –Ω–∏–∫–∞';

      const idDiv = document.createElement('div');
      idDiv.className = 'friend-id';
      idDiv.textContent = friend.id;

      info.appendChild(nick);
      info.appendChild(idDiv);

      const btns = document.createElement('div');
      btns.className = 'friend-buttons';

      // –ö–Ω–æ–ø–∫–∞ –∑–∞–π—Ç–∏ –≤ –∫–≤–∞—Ä—Ç–∏—Ä—É –¥—Ä—É–≥–∞
      const btnEnter = document.createElement('button');
      btnEnter.textContent = '–ó–∞–π—Ç–∏ –≤ –∫–≤–∞—Ä—Ç–∏—Ä—É';
      btnEnter.onclick = () => {
        if(friend.lastRoomData) {
          loadFriendRooms(friend.lastRoomData);
        } else {
          alert('–ö–≤–∞—Ä—Ç–∏—Ä–∞ –¥—Ä—É–≥–∞ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –¥—Ä—É–≥–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö".');
        }
      };

      // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–∏—Ç—å –¥—Ä—É–≥–∞
      const btnRemove = document.createElement('button');
      btnRemove.textContent = '–£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π';
      btnRemove.onclick = () => {
        if(confirm(`–£–¥–∞–ª–∏—Ç—å –¥—Ä—É–≥–∞ ${friend.nick || friend.id}?`)) {
          removeFriend(friend.id);
        }
      };

      // –ö–Ω–æ–ø–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID –¥—Ä—É–≥–∞
      const btnCopy = document.createElement('button');
      btnCopy.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID';
      btnCopy.onclick = () => {
        navigator.clipboard.writeText(friend.id).then(() => {
          alert('ID –¥—Ä—É–≥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
        });
      };

      btns.appendChild(btnEnter);
      btns.appendChild(btnCopy);
      btns.appendChild(btnRemove);

      card.appendChild(ava);
      card.appendChild(info);
      card.appendChild(btns);

      friendsListDiv.appendChild(card);
    });
  }

  // --- –ö–û–ü–ò–†–û–í–ê–ù–ò–ï / –í–°–¢–ê–í–ö–ê –ö–û–î–ê –ö–í–ê–†–¢–ò–†–´ ---

  // –ö–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã - —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–Ω–∞—Ç –≤ —Å—Ç—Ä–æ–∫—É base64
  function encodeRooms(rooms) {
    return btoa(JSON.stringify(rooms));
  }
  // –î–µ–∫–æ–¥–∏–Ω–≥
  function decodeRooms(code) {
    try {
      return JSON.parse(atob(code));
    } catch {
      return null;
    }
  }

  // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ —Ç–µ–∫—É—â–µ–π –∫–≤–∞—Ä—Ç–∏—Ä—ã
  copyRoomCodeBtn.onclick = () => {
    // –ö–æ–¥–∏—Ä—É–µ–º –≤—Å—é –∫–≤–∞—Ä—Ç–∏—Ä—É
    const code = encodeRooms(rooms);
    const codeWithNick = `–ù–∏–∫: ${userProfile.nick}\n–ö–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã:\n${code}`;
    navigator.clipboard.writeText(codeWithNick).then(() => {
      alert('–ö–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    });
  };

  // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞
  pasteRoomCodeBtn.onclick = () => {
    roomCodeInput.value = '';
    modalOverlay.style.display = 'flex';
    roomCodeInput.focus();
  };

  modalCancelBtn.onclick = () => {
    modalOverlay.style.display = 'none';
  };

  modalOkBtn.onclick = () => {
    const val = roomCodeInput.value.trim();
    if(!val) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã');
    // –ü–æ–ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∫–æ–¥ (–≤–æ–∑–º–æ–∂–Ω–æ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å –Ω–∏–∫ –∏ –∫–æ–¥)
    let code = null;
    if(val.includes('–ö–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã:')) {
      const parts = val.split('–ö–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã:');
      code = parts[1].trim();
    } else {
      code = val;
    }
    const roomsData = decodeRooms(code);
    if(!roomsData) return alert('–ö–æ–¥ –∫–≤–∞—Ä—Ç–∏—Ä—ã –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–π');
    // –ó–∞–≥—Ä—É–∑–∏–º –≤ –¥—Ä—É–∑—å—è –∫–∞–∫ lastRoomData
    alert('–ö–≤–∞—Ä—Ç–∏—Ä–∞ –¥—Ä—É–≥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –ß—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –¥—Ä—É–≥ –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –¥–ª—è –¥—Ä—É–≥–∏—Ö.');
    modalOverlay.style.display = 'none';

    // –°–æ–∑–¥–∞–¥–∏–º "–≥–æ—Å—Ç–µ–≤–æ–π" —Ä–µ–∂–∏–º: –¥–æ–±–∞–≤–∏–º —ç—Ç—É –∫–≤–∞—Ä—Ç–∏—Ä—É –∫ —Ç–µ–∫—É—â–µ–º—É –ø—Ä–æ–µ–∫—Ç—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    loadFriendRooms(roomsData);
  };

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã –¥—Ä—É–≥–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–≤—Ä–µ–º–µ–Ω–Ω–æ, –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞)
  function loadFriendRooms(friendRoomsData) {
    // –ó–∞–º–µ–Ω–∏–º –∫–æ–º–Ω–∞—Ç—ã –Ω–∞ –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–∞
    rooms = friendRoomsData;
    currentRoomIndex = 0;
    updateRoomUI();
  }

  // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---

  function init() {
    fillSelectors();
    loadUserProfile();
    loadRooms();
    loadFriends();
    updateRoomUI();
    createFurnitureItemsUI();
    renderFriends();
    resizeCanvas();
  }

  // --- –°–û–ë–´–¢–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô ---

  wallpaperSelect.onchange = saveRoomSettings;
  wallpaperColorInput.oninput = saveRoomSettings;
  floorSelect.onchange = saveRoomSettings;
  floorColorInput.oninput = saveRoomSettings;

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–º–Ω–∞—Ç—É, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∏–¥–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
  window.addEventListener('beforeunload', () => {
    saveRooms();
    saveUserProfile();
    saveFriends();
  });

  init();

})();
</script>

</body>
</html>
